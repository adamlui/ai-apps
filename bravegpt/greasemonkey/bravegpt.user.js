// ==UserScript==
// @name                BraveGPT ðŸ¤–
// @description         Adds ChatGPT answers to Brave Search sidebar (powered by GPT-4!)
// @description:af      Voeg ChatGPT-antwoorde by Brave Search-kantbalk by (aangedryf deur GPT-4!)
// @description:am      á‹¨ChatGPT áˆ˜áˆáˆµáŠ“á‹ˆáˆ­á‰ƒáˆˆá‰½ áŠ¥áˆ­áˆµá‹ŽáŠ• á‰ Brave Search á‹¨á‰°á‹ˆáˆ°áŠ‘ áŒˆáŒ½á‰³á‹Žá‰½áŠ• (á‰°áŒá‰£áˆ­ á‰ GPT-4!) á‹­áŒ¨áˆáˆ©
// @description:ar      ÙŠØ¶ÙŠÙ Ø¥Ø¬Ø§Ø¨Ø§Øª ChatGPT Ø¥Ù„Ù‰ Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ ÙÙŠ Brave (Ù…Ø¯Ø¹ÙˆÙ… Ø¨ÙˆØ§Ø³Ø·Ø© GPT-4!)
// @description:az      ChatGPT cavablarÄ±nÄ± Brave AxtarÄ±ÅŸ yan panelinÉ™ É™lavÉ™ edir (GPT-4 ilÉ™ gÃ¼clÉ™ndirilmiÅŸ!)
// @description:be      Ð”Ð°Ð´Ð°Ðµ Ð°Ð´ÐºÐ°Ð·Ñ‹ ChatGPT Ð´Ð° Ð±Ð°ÐºÐ°Ð²Ð¾Ð¹ Ð±Ð°ÐºÐ¾Ð²Ð°Ð¹ Ð¿Ð°Ð½ÑÐ»Ñ– Brave Search (Ð¿Ð°Ð´Ñ‚Ñ€Ñ‹Ð¼Ð»Ñ–Ð²Ð°ÐµÑ†Ñ†Ð° GPT-4!)
// @description:bem      Aziya ChatGPT ndalama ku Brave Search sidebar (muma GPT-4!)
// @description:bg      Ð”Ð¾Ð±Ð°Ð²Ñ ChatGPT Ð¾Ñ‚Ð³Ð¾Ð²Ð¾Ñ€Ð¸ ÐºÑŠÐ¼ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ‡Ð½Ð°Ñ‚Ð° Ð»ÐµÐ½Ñ‚Ð° Ð½Ð° Brave Search (Ð·Ð°Ð´Ð²Ð¸Ð¶Ð²Ð°Ð½ Ð¾Ñ‚ GPT-4!)
// @description:bn      Brave à¦¸à¦¾à¦°à§à¦š à¦¸à¦¾à¦‡à¦¡à¦¬à¦¾à¦°à§‡ ChatGPT à¦‰à¦¤à§à¦¤à¦° à¦¯à§‹à¦— à¦•à¦°à§‡ (à¦ªà¦¾à¦“à¦¯à¦¼à¦¾à¦°à¦¡à§‡ GPT-4 à¦¦à§à¦¬à¦¾à¦°à¦¾!)
// @description:bo      ChatGPT à½£à½ºà¼‹à½–à½¦à¼‹à½šà½‘à¼‹à½–à½‘à½‚à¼‹à½¦à¾à¾±à½ºà½‘à¼‹à½‘à½ºà¼‹à½–à½Ÿà½´à½˜à¼‹à½¦à¾’à¾²à½²à½‚à¼‹à½“à½„à¼‹ Brave Search à½‚à½“à½¦à¼‹à½”à¼‹à½–à½¢à¾—à½¼à½‘à¼‹à½”à¼ (GPT-4à½–à¾±à¼‹à½–à¼‹à½–à½¢à¾’à¾±à½´à½‘à¼‹à½”à¼‹!)
// @description:bs      Dodaje odgovore ChatGPT-a na boÄnu traku Brave pretrage (pokreÄ‡e GPT-4!)
// @description:ca      Afegeix respostes de ChatGPT a la barra lateral de Brave Search (amb tecnologia GPT-4!)
// @description:ceb      Nagdugang sa mga tubag sa ChatGPT sa sidebar sa Brave Search (gamit ang GPT-4!)
// @description:ckb      ÙˆÛ•Ø±Ú¯Ø±ØªÙ†ÛŒ Ú•Ø§Ø³ØªÛ•ÙˆØ®Û†ÛŒÛŒ ChatGPT Ø¨Û† Ù¾Û•Ù†Ø¬Û•Ø±Û•ÛŒ Ù„Ø§ØªÛŒ Ù„Û• Brave (Ø¨Û• Ù¾Ø´ØªÚ¯ÛŒØ±ÛŒÛŒÛŒ GPT-4!)
// @description:cs      PÅ™idÃ¡vÃ¡ odpovÄ›di od ChatGPT do boÄnÃ­ho panelu Brave Search (pohÃ¡nÄ›no GPT-4!)
// @description:cy      Ychwanega Atebion ChatGPT i'r bar ochr Brave Search (a gryfhawyd gan GPT-4!)
// @description:da      TilfÃ¸jer ChatGPT-svar til Brave Search-sidelinjen (drevet af GPT-4!)
// @description:de      FÃ¼gt ChatGPT-Antworten zur Seitenleiste der Brave-Suche hinzu (betrieben mit GPT-4!)
// @description:dv      ChatGPT Þ‡Þ¦Þ‡Þ¨Þ†Þ°ÞÞ­Þ“ÞªÞŽÞ¬ Þ–Þ¦ÞˆÞ§Þ„ÞªÞŽÞ¬ Brave Search ÞÞ¦Þ‡Þ¨Þ“ÞªÞŽÞ¦Þ‡Þ¨ ÞŠÞ¯ÞƒÞªÞˆÞ§ÞƒÞ¦Þ‡ÞªÞŽÞ¬ Þ‘Þ¦Þ‡ÞªÞ‚Þ° (Þ‡Þ¬Þ†Þ¦Þ‡ÞªÞ‚Þ°Þ‡Þ¦Þ‡Þ¨ ÞˆÞ¦Þ†Þ¨ GPT-4!)
// @description:dz      ChatGPT à½‘à½„à¼‹ Brave à½ à½–à¾±à½´à½„à¼‹à½†à½´à½„à¼‹à½£à½ºà¼‹à½–à½¦à¼‹à½ à½à½´à½¦à¼‹à½”à¼‹à½£à½‚à½¦à¼‹à½¦à¾¤à¾±à½¼à½‘à¼‹à½¦à¾’à¾²à½²à½‚à¼‹à½”à¼‹à½–à½¢à¾Ÿà½‚à½¦à¼‹à½–à½žà½´à½‚à½¦à¼ (GPT-4à¼‹à½‚à½²à¼‹à½¦à¾’à¾²à½²à½‚à¼‹à½‘à½„à¼‹!)
// @description:el      Î ÏÎ¿ÏƒÎ¸Î­Ï„ÎµÎ¹ Î±Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹Ï‚ ChatGPT ÏƒÏ„Î·Î½ Ï€Î»Î±ÏŠÎ½Î® Î³ÏÎ±Î¼Î¼Î® Î±Î½Î±Î¶Î®Ï„Î·ÏƒÎ·Ï‚ Ï„Î¿Ï… Brave (Î¼Îµ Ï„Î·Î½ Ï…Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· Ï„Î¿Ï… GPT-4!)
// @description:eo      Aldonas ChatGPT-respondojn al la flanka breto de Brave SerÄ‰o (funkciigita de GPT-4!)
// @description:es      Agrega respuestas de ChatGPT a la barra lateral de Brave Search (Â¡impulsado por GPT-4!)
// @description:et      Lisab ChatGPT vastused Brave Search kÃ¼ljepaneelile (toetatud GPT-4 poolt!)
// @description:eu      Gehitu ChatGPT erantzunak Brave Search aldeko alderakoan (GPT-4ren aurrerapenean oinarrituta!)
// @description:fa      ChatGPT Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ù‡ Ù†ÙˆØ§Ø± Ú©Ù†Ø§Ø±ÛŒ Ø¬Ø³ØªØ¬ÙˆÛŒ Brave Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ (Ù‚Ø¯Ø±Øª Ú¯Ø±ÙØªÙ‡ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· GPT-4!)
// @description:fi      LisÃ¤Ã¤ ChatGPT-vastaukset Brave-haun sivupalkkiin (kÃ¤yttÃ¤en GPT-4!)
// @description:fo      Leggur ChatGPT-svar til Brave leitarstika sÃ­Ã°upall (drivin av GPT-4!)
// @description:fr      Ajoute les rÃ©ponses de ChatGPT Ã  la barre latÃ©rale de Brave Search (propulsÃ© par GPT-4 !)
// @description:fr-CA   Ajoute les rÃ©ponses de ChatGPT Ã  la barre latÃ©rale de Brave Search (propulsÃ© par GPT-4 !)
// @description:gd      Cur Freagairtean ChatGPT ris an t-siostam-cÃ¹laiche airson Innse Brave (le GPT-4 air!)
// @description:gl      Engade respostas de ChatGPT Ã¡ barra lateral de busca de Brave (potenciado por GPT-4!)
// @description:gu      àª¬à«àª°à«‡àªµ àª¶à«‹àª§àª¨àªªàªŸàª¨àª®àª¾àª‚ ChatGPT àªœàªµàª¾àª¬à«‹ àª‰àª®à«‡àª°à«‡ àª›à«‡ (àªªàª¾àªµàª°à«àª¡àªªà«àª‚àªœ GPT-4 àª¦à«àªµàª¾àª°àª¾!)
// @description:haw     HoÊ»oni i nÄ manaÊ»oÊ»iÊ»o ChatGPT i loko o ka papa kÄlai Brave Search (i hoÊ»ohui Ê»ia e GPT-4!)
// @description:he      ×ž×•×¡×™×£ ×ª×©×•×‘×•×ª ×©×œ ChatGPT ×œ×¡×¨×’×œ ×”×¦×“ ×©×œ ×—×™×¤×•×© Brave (×ž×•×¤×¢×œ ×¢×œ ×™×“×™ GPT-4!)
// @description:hi      à¤¬à¥à¤°à¥‡à¤µ à¤¸à¤°à¥à¤š à¤¸à¤¾à¤‡à¤¡à¤¬à¤¾à¤° à¤®à¥‡à¤‚ ChatGPT à¤‰à¤¤à¥à¤¤à¤° à¤œà¥‹à¤¡à¤¼à¤¤à¤¾ à¤¹à¥ˆ (GPT-4 à¤¦à¥à¤µà¤¾à¤°à¤¾ à¤¸à¤‚à¤šà¤¾à¤²à¤¿à¤¤!)
// @description:hr      Dodaje odgovore ChatGPT-a na boÄnu traku Brave pretraÅ¾ivanja (pokreÄ‡e GPT-4!)
// @description:ht      Ajoute ChatGPT repons nan sibbard Brave Search la (pouvwa pa GPT-4!)
// @description:hu      HozzÃ¡adja a ChatGPT vÃ¡laszokat a Brave Search oldalsÃ¡vjÃ¡hoz (GPT-4 Ã¡ltal tÃ¡mogatva!)
// @description:hy      Ô±Õ¾Õ¥Õ¬Õ¡ÖÕ¶Õ¸Ö‚Õ´ Õ§ ChatGPT ÕºÕ¡Õ¿Õ¡Õ½Õ­Õ¡Õ¶Õ¶Õ¥Ö€Õ¨ Brave Search Õ¯Õ¸Õ²Õ´Õ«Ö (Õ¸Ö‚Õ²Õ²Õ¡Õ°Õ¡ÕµÕ¡ÖÕ¾Õ¡Õ® Õ§ GPT-4-Õ« Õ´Õ«Õ»Õ¸ÖÕ¸Õ¾!)
// @description:id      Menambahkan jawaban ChatGPT ke sidebar Brave Search (didukung oleh GPT-4!)
// @description:is      BÃ¦tir viÃ° ChatGPT svari Ã­ hliÃ°arstiku Brave leitarinnar (rekinn meÃ° GPT-4!)
// @description:it      Aggiunge le risposte di ChatGPT alla barra laterale di Brave Search (alimentato da GPT-4!)
// @description:ja      Brave æ¤œç´¢ã‚µã‚¤ãƒ‰ãƒãƒ¼ã« ChatGPT ã®å›žç­”ã‚’è¿½åŠ ã—ã¾ã™ï¼ˆGPT-4 ã§å‹•ä½œä¸­ï¼ï¼‰
// @description:jv      Nambahake jawaban ChatGPT menyang sidebar Pencarian Brave (didheteni GPT-4!)
// @description:ka      áƒ“áƒáƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ¡ ChatGPT áƒžáƒáƒ¡áƒ£áƒ®áƒ”áƒ‘áƒ¡ Brave Search áƒ’áƒ•áƒ”áƒ áƒ“áƒ˜áƒ¡ áƒ›áƒáƒ áƒ¯áƒ•áƒœáƒ˜áƒ• (GPT-4-áƒ˜áƒ— áƒ’áƒáƒ›áƒáƒ§áƒ”áƒœáƒ”áƒ‘áƒ£áƒšáƒ˜!)
// @description:kab     Izgan-d yemdanen n teblaá¸ n Brave Search (É£ef GPT-4!)
// @description:kk      Brave Ñ–Ð·Ð´ÐµÑƒ Ð¶Ð°Ò“Ð´Ð°Ð¹Ñ‹Ð½Ð´Ð°Ò“Ñ‹ ChatGPT Ð¶Ð°ÑƒÐ°Ð¿Ñ‚Ð°Ñ€Ñ‹Ð½ Ò›Ð¾ÑÐ°Ð´Ñ‹ (GPT-4-Ð¼ÐµÐ½ Ð¶Ò±Ð¼Ñ‹Ñ Ñ–ÑÑ‚ÐµÐ¹Ð´Ñ–!)
// @description:km      áž”áž“áŸ’ážáŸ‚áž˜áž…áž˜áŸ’áž›áž¾áž™ ChatGPT áž‘áŸ…ážšáž”áž¶ážšáž…áŸ†áž áŸ€áž„ážŸáŸ’ážœáŸ‚áž„ážšáž€áž€áŸ’áž›áž¶áž áž¶áž“ (ážŠáŸ†ážŽáž¾ážšáž€áž¶ážšážŠáŸ„áž™ GPT-4!)
// @description:kn      à²¬à³à²°à³‡à²µà³ à²¶à³‹à²§à²¨à³† à²ªà²Ÿà³à²Ÿà²¿à²—à³† ChatGPT à²‰à²¤à³à²¤à²°à²—à²³à²¨à³à²¨à³ à²¸à³‡à²°à²¿à²¸à³à²¤à³à²¤à²¦à³† (GPT-4 à²…à²¨à³à²¨à³ à²¬à²³à²¸à²¿!)
// @description:ko      ChatGPT ë‹µë³€ì„ Brave ê²€ìƒ‰ ì‚¬ì´ë“œë°”ì— ì¶”ê°€í•©ë‹ˆë‹¤ (GPT-4ë¡œ êµ¬ë™ë¨!)
// @description:ku      Li ser panoya li serÃª lÃªgerÃ®na Brave dihÃªle ChatGPT bersivan (bi alÃ®kariya GPT-4!)
// @description:ky      ChatGPT ÐºÐ°Ð°Ñ€Ð´Ð°Ñ€Ð»Ð°Ñ€Ñ‹Ð½ Ð‘Ñ€Ð°Ð²Ðµ Ð˜Ð·Ð´Ó©Ó© ÑÐºÐ¸Ð±Ð¸Ð½Ñ‹Ð½ ÐºÓ©Ð½Ñ‡Ñ‹Ð³Ñ‹ÑˆÑ‹Ð½Ð° ÐºÐ¾ÑˆÐ¾Ñ‚Ð¾Ñ‚ (GPT-4 Ð¼ÐµÐ½ÐµÐ½ ÐºÒ¯Ñ‚Ó©Ð»Ð³Ó©Ð½!)
// @description:la      Adiungit responsiones ChatGPT ad barra lateralem investigatiois Brave (GPT-4 motore!)
// @description:lb      FÃ¼Ã¼gt ChatGPT Ã„ntwerten zur Brave-SichbarsÃ¤it bÃ¤i (gedriwwen vun GPT-4!)
// @description:lo      àº•àº­àºšàºªàº­àº™ ChatGPT à»„àº›àº«àº²à»àº–àºšàº‚àº±à»‰àº™àº•àº­àº™àº‚àº­àº‡àºàº²àº™àº„àº»à»‰àº™àº«àº² Brave (à»‚àº”àºà»ƒàºŠà»‰ GPT-4!)
// @description:lt      Prideda ChatGPT atsakymus Ä¯ Å¡oninÄ™ juostÄ… paieÅ¡kai Brave (varomi GPT-4!)
// @description:lv      Pievieno ChatGPT atbildes Brave meklÄ“Å¡anas sÄnjoslai (darbinÄts ar GPT-4!)
// @description:mg      Mampiditra valiny avy amin'ny ChatGPT ao amin'ny saroka Search Brave (maneho ny GPT-4!)
// @description:mi      TÄpiri atu i ngÄ whakautu a ChatGPT ki te tara taha o te Rapu Wawata Brave (e whakahaerehia ana e GPT-4!)
// @description:mk      Ð”Ð¾Ð´Ð°Ð²Ð° Ð¾Ð´Ð³Ð¾Ð²Ð¾Ñ€Ð¸ Ð¾Ð´ ChatGPT Ð½Ð° ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ‡Ð½Ð°Ñ‚Ð° Ð»ÐµÐ½Ñ‚Ð° Ð½Ð° Brave Search (Ð¿Ð¾Ð´Ð´Ñ€Ð¶Ð°Ð½Ð¾ Ð¾Ð´ GPT-4!)
// @description:ml      Brave à´¸àµ‡àµ¼à´šàµà´šà´¿à´¨àµà´±àµ† à´¸àµˆà´¡àµà´¬à´¾àµ¼à´²àµ‡à´•àµà´•àµ ChatGPT à´‰à´¤àµà´¤à´°à´™àµà´™àµ¾ à´šàµ‡àµ¼à´•àµà´•àµà´¨àµà´¨àµ (GPT-4-à´¯à´¿àµ½ à´ªàµà´°à´µàµ¼à´¤àµà´¤à´¿à´•àµà´•àµà´¨àµà´¨àµ!)
// @description:mn      ChatGPT Ñ…Ð°Ñ€Ð¸ÑƒÐ»Ñ‚ÑƒÑƒÐ´Ñ‹Ð³ Brave Ð¥Ð°Ð¹Ð»Ñ‚Ñ‹Ð½ Ð·Ð°Ð°Ð²Ñ€Ñ‹Ð½ Ð·ÑƒÑ€Ð°Ð³Ñ‚ Ð½ÑÐ¼Ð½Ñ (GPT-4 Ð°ÑˆÐ¸Ð³Ð»Ð°Ð¶!)
// @description:ms      Menambah jawapan ChatGPT ke sidebar Carian Brave (dikuasakan oleh GPT-4!)
// @description:mt      IÅ¼Å¼id Risposti ta 'ChatGPT lill-Sidebar Brave Search (pwered by GPT-4!)
// @description:my      ChatGPT á€¡á€–á€¼á€±á€™á€¾á€¬ Brave á€›á€½á€±á€¸á€á€»á€šá€ºá€›á€±á€¸á€á€½á€„á€º ChatGPT á€¡á€–á€¼á€±á€™á€»á€¬á€¸á€€á€­á€¯á€‘á€Šá€·á€ºá€žá€½á€„á€ºá€¸á€‘á€¬á€¸á€žá€Šá€º (GPT-4 á€–á€¼á€„á€·á€ºá€¡á€œá€¯á€•á€ºá€œá€¯á€•á€ºá€•á€«!)
// @description:ne      ChatGPT à¤‰à¤¤à¥à¤¤à¤°à¤¹à¤°à¥‚à¤²à¤¾à¤ˆ à¤¬à¥à¤°à¥‡à¤­ à¤–à¥‹à¤œà¤•à¥‹ à¤¸à¤¾à¤‡à¤¡à¤¬à¤¾à¤°à¤®à¤¾ à¤¥à¤ªà¥à¤› (GPT-4 à¤¦à¥à¤µà¤¾à¤°à¤¾ à¤¸à¤‚à¤šà¤¾à¤²à¤¿à¤¤!)
// @description:nl      Voegt ChatGPT-antwoorden toe aan de zijbalk van Brave Search (aangedreven door GPT-4!)
// @description:no      Legger til ChatGPT-svar i sidenotatfeltet for Brave Search (drevet av GPT-4!)
// @description:ny      Anayambitsa zambiri za ChatGPT kubanja lovala la Brave Search (liyenera ndi GPT-4!)
// @description:pa      à¨¬à¨°à©‡à¨µ à¨–à©‹à¨œ à¨¦à©‡ à¨¸à¨¾à¨ˆà¨¡à¨¬à¨¾à¨° à¨µà¨¿à©±à¨š ChatGPT à¨œà¨µà¨¾à¨¬ à¨¸à¨¼à¨¾à¨®à¨² à¨•à¨°à¨¦à¨¾ à¨¹à©ˆ (GPT-4 à¨¦à©à¨†à¨°à¨¾ à¨¸à¨¼à¨•à¨¤à©€à¨¶à¨¾à¨²à¨• à¨•à©€à¨¤à¨¾ à¨—à¨¿à¨†!)
// @description:pap     AÃ±adi respuÃ¨stanan di ChatGPT na bar lateral di Buskeda Brave (poderÃ¡ pa GPT-4!)
// @description:pl      Dodaje odpowiedzi ChatGPT do paska bocznego Brave Search (napÄ™dzane przez GPT-4!)
// @description:ps      Ù¾Ù‡ Ø³Ù¾ÛŒÙ†Û Ø¯ Brave Ù„Ù¼ÙˆÙ†Ú©Û ØªÙˆÚ«Ù‡ ChatGPT Ø¬ÙˆØ§Ø¨ÙˆÙ†Ù‡ ÙˆØ±Ú©Ú“ÙŠ (Ø¯ GPT-4 Ù„Ø®ÙˆØ§ Ø³Ø±Ù‡!)
// @description:pt      Adiciona respostas do ChatGPT Ã  barra lateral de pesquisa do Brave (alimentado por GPT-4!)
// @description:pt-BR   Adiciona respostas do ChatGPT Ã  barra lateral de pesquisa do Brave (alimentado por GPT-4!)
// @description:rn      Abugira inkomoko za ChatGPT mu gisubizo cya Brave Search (yahindutse na GPT-4!)
// @description:ro      AdaugÄƒ rÄƒspunsuri ChatGPT Ã®n bara lateralÄƒ de cÄƒutare Brave (propulsat de GPT-4!)
// @description:ru      Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÑ‚ Ð¾Ñ‚Ð²ÐµÑ‚Ñ‹ ChatGPT Ð² Ð±Ð¾ÐºÐ¾Ð²ÑƒÑŽ Ð¿Ð°Ð½ÐµÐ»ÑŒ Ð¿Ð¾Ð¸ÑÐºÐ° Brave (Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð½Ð° GPT-4!)
// @description:rw      Atera amakuru ya ChatGPT mu bariro bya Brave Search (yarahindutse n'ikoranabuhanga cya GPT-4!)
// @description:sg      YÃ£ngÃ£ aÃ± fÃ£Ã£mi ChatGPT pÅ©ngu loo yaaka yi Brave tÃ£ngbala (saango wÃ£ yi GPT-4!)
// @description:si      à¶”à¶¶à·š Brave à·ƒà·™à·€à·”à¶¸à·Š à¶´à·’à·…à·’à¶­à·”à¶»à·”à¶¯ ChatGPT à¶‘à¶šà·Š à¶šà·’à¶»à·“à¶¸à·™à¶±à·Š à¶‘à¶šà·Šà·€à¶±à·Šà¶± (GPT-4 à·€à·’à¶¯à·Šâ€à¶ºà·à·€à¶½à·’à¶ºà·š à·ƒà·’à¶¯à·” à·€à·š!)
// @description:sk      PridÃ¡va odpovede ChatGPT do boÄnej liÅ¡ty Brave Search (pohÃ¡ÅˆanÃ© GPT-4!)
// @description:sl      Dodaja odgovore ChatGPT na stransko vrstico iskanja Brave (poganja GPT-4!)
// @description:sm      Fa'afaigofie atu ai le tali a ChatGPT i le sidebar o le Search Brave (e avea i le GPT-4!)
// @description:sn      Anoratidza zita reChatGPT pa sidebar yeBrave Search (ine vedzere GPT-4!)
// @description:so      Wax ka dar ChatGPT jawaabaha sidebar Brave Search (u shaqeeya GPT-4!)
// @description:sr      Ð”Ð¾Ð´Ð°Ñ˜Ðµ Ð¾Ð´Ð³Ð¾Ð²Ð¾Ñ€Ðµ ChatGPT-Ð° Ð½Ð° ÑÑ‚Ñ€Ð°Ð½Ð¸ Ð¿Ð°Ð½ÐµÐ» Ð¿Ñ€ÐµÑ‚Ñ€Ð°Ð³Ðµ Ð‘Ñ€ÐµÑ˜Ð²Ð° (Ð¿Ð¾ÐºÑ€ÐµÑ›Ðµ Ð“ÐŸÐ¢-4!)
// @description:sv      LÃ¤gger till ChatGPT-svar i sidofÃ¤ltet fÃ¶r Brave SÃ¶kning (drivet av GPT-4!)
// @description:sw      Inaongeza majibu ya ChatGPT kwenye upau wa pembeni wa Brave Search (inaendeshwa na GPT-4!)
// @description:ta      à®ªà¯‡à®°à®¾à®šà¯ˆ à®†à®¯à¯à®µà¯à®•à¯ à®•à¯‡à®Ÿà¯à®ªà®¤à®±à¯à®•à¯ ChatGPT à®ªà®¤à®¿à®²à¯à®•à®³à¯ˆ Brave à®ªà®•à¯à®• à®ªà®•à¯à®•à®¿à®²à¯ à®šà¯‡à®°à¯à®•à¯à®•à®¿à®±à®¤à¯ (GPT-4 à®†à®²à¯ à®‡à®¯à®™à¯à®•à¯à®•à®¿à®±à®¤à¯!)
// @description:te      Brave à°¶à±‹à°§à°¨à°ªà±ˆ ChatGPT à°¸à°®à°¾à°§à°¾à°¨à°¾à°²à°¨à± à°œà±‹à°¡à°¿à°¸à±à°¤à±à°‚à°¦à°¿ (GPT-4 à°¦à±à°µà°¾à°°à°¾ à°ªà±†à°‚à°šà°¬à°¡à°¿à°‚à°¦à°¿!)
// @description:tg      Ð¨Ð°Ñ€Ò³Ð¸ ChatGPT-Ñ€Ð¾ Ð±Ð° ÑÐ°Ñ‚Ò³Ð¸ Ð±Ð°Ñ€Ð¾Ð¸ Ò·ÑƒÑÑ‚ÑƒÒ·Ó¯Ð¸ Ð‘Ñ€ÐµÐ¹Ð² Ð¸Ð»Ð¾Ð²Ð° Ð¼ÐµÐºÑƒÐ½Ð°Ð´ (Ñ‚Ð°Ð²Ð°ÑÑÑƒÑ‚Ð¸ GPT-4 Ð¼ÑƒÐ±Ð¾Ð´Ð¸ÑŠ Ð±ÑƒÐ´Ð°Ð°ÑÑ‚!)
// @description:th      à¹€à¸žà¸´à¹ˆà¸¡à¸„à¸³à¸•à¸­à¸šà¸‚à¸­à¸‡ ChatGPT à¹„à¸›à¸¢à¸±à¸‡à¹à¸–à¸šà¸‚à¹‰à¸²à¸‡à¸‚à¸­à¸‡à¸à¸²à¸£à¸„à¹‰à¸™à¸«à¸² Brave (à¸—à¸³à¸‡à¸²à¸™à¹‚à¸”à¸¢ GPT-4!)
// @description:ti      áŠ­áˆáˆ áŒ¸áŒ‹áŠ• ChatGPT áˆ˜áˆáŠ¥áŠ½á‰µ áŠ•áˆáˆµáˆ­áˆ“á‰¥ Brave á‹áˆá‰€á‰µ á‹­áŒ¨áˆáˆ© (á‰ á‰€áˆ¨á‰  GPT-4!)
// @description:tk      ChatGPT-nyÅˆ jogaplaryny Brave GÃ¶zleg Ã§arpyÅŸysyna goÅŸÃ½ar (GPT-4-dan gÃ¼Ã½Ã§lenÃ½Ã¤r!)
// @description:tn      Enza mavoti ChatGPT ku sidebar yeBrave Search (ine yeduva neGPT-4!)
// @description:to      TÄnaki e fiemaÊ»u ai ha ngaahi ngaue fakamatala 'a e ChatGPT ki he tu'unga ni ha Brave Search (na'e neongo'i moe GPT-4!)
// @description:tpi     Adim na pes bilong ChatGPT long tab bilong Brave SÃ¸k (wok long GPT-4!)
// @description:tr      ChatGPT yanÄ±tlarÄ±nÄ± Brave Arama yan Ã§ubuÄŸuna ekler (GPT-4 tarafÄ±ndan desteklenir!)
// @description:uk      Ð”Ð¾Ð´Ð°Ñ” Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ñ– ChatGPT Ð´Ð¾ Ð±Ñ–Ñ‡Ð½Ð¾Ñ— Ð¿Ð°Ð½ÐµÐ»Ñ– Ð¿Ð¾ÑˆÑƒÐºÑƒ Brave (Ð¿Ñ€Ð°Ñ†ÑŽÑ” Ð½Ð° GPT-4!)
// @description:ur      ChatGPT Ø¬ÙˆØ§Ø¨Ø§Øª Ú©Ùˆ Ø¨Ø±ÛŒÙˆ Ø³Ø±Ú† Ú©Û’ Ø³Ø§Ø¦ÚˆØ¨Ø§Ø± Ù…ÛŒÚº Ø´Ø§Ù…Ù„ Ú©Ø±ØªØ§ ÛÛ’ (GPT-4 Ú©Û’ Ø°Ø±ÛŒØ¹Û’!)
// @description:uz      ChatGPT javoblarni Brave Qidiruvning yon paneliga qo'shadi (GPT-4 tomonidan ta'minlanadi!)
// @description:vi      ThÃªm cÃ¢u tráº£ lá»i cá»§a ChatGPT vÃ o thanh bÃªn cá»§a Brave Search (Ä‘Æ°á»£c cung cáº¥p bá»Ÿi GPT-4!)
// @description:xh      Enza amaxwebhu kaChatGPT e sideba yeBrave Search (enokukhuthaziswa nguGPT-4!)
// @description:yi      ×¦×•×’×¢×‘×Ÿ ×Ö·× ×˜×•×•×Ö¸×¨×˜×Ÿ ×¤Ö¿×•×Ÿ ChatGPT ××™×Ÿ ×“×™ ×–×²Ö·×˜×œ-×¤Ö¿×¢×œ×“ ×¤Ö¿×•×Ÿ Brave ×–×•×š (×’×¢×¤Ö¼×Ö·×•×•×¢×¨×˜×¢×“ ×“×•×¨×š GPT-4!)
// @description:zh      å°† ChatGPT ç­”æ¡ˆæ·»åŠ åˆ° Brave Search ä¾§è¾¹æ  (ç”± GPT-4 æä¾›æ”¯æŒ!)
// @description:zh-CN   å°† ChatGPT ç­”æ¡ˆæ·»åŠ åˆ° Brave Search ä¾§è¾¹æ  (ç”± GPT-4 æä¾›æ”¯æŒ!)
// @description:zh-HK   å°‡ ChatGPT ç­”æ¡ˆæ·»åŠ åˆ° Brave Search å´é‚Šæ¬„ (ç”± GPT-4 æä¾›æ”¯æŒ!)
// @description:zh-SG   å°† ChatGPT ç­”æ¡ˆæ·»åŠ åˆ° Brave Search ä¾§è¾¹æ  (ç”± GPT-4 æä¾›æ”¯æŒ!)
// @description:zh-TW   å°‡ ChatGPT ç­”æ¡ˆæ·»åŠ åˆ° Brave Search å´é‚Šæ¬„ (ç”± GPT-4 æä¾›æ”¯æŒ!)
// @description:zu      Engeza amaswazi aseChatGPT emugqa wokuqala weBrave Search (ibhulohwe nguGPT-4!)
// @author              KudoAI
// @namespace           https://kudoai.com
// @version             2023.8.9
// @license             MIT
// @icon                https://media.bravegpt.com/images/bravegpt-icon48.png
// @icon64              https://media.bravegpt.com/images/bravegpt-icon64.png
// @compatible          chrome
// @compatible          firefox
// @compatible          edge
// @compatible          opera
// @compatible          brave
// @compatible          vivaldi
// @compatible          librewolf
// @compatible          ghost
// @compatible          qq
// @match               https://search.brave.com/search*
// @include             https://auth0.openai.com
// @connect             raw.githubusercontent.com
// @connect             greasyfork.org
// @connect             chat.openai.com
// @connect             api.aigcfun.com
// @require             https://cdn.jsdelivr.net/gh/kudoai/chatgpt.js@0ccfc9e6acfcc24f864b233199f811316cfcd136/dist/chatgpt-2.0.6.min.js
// @require             https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js
// @require             https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js
// @grant               GM_getValue
// @grant               GM_setValue
// @grant               GM_deleteValue
// @grant               GM_cookie
// @grant               GM_registerMenuCommand
// @grant               GM_unregisterMenuCommand
// @grant               GM_openInTab
// @grant               GM.xmlHttpRequest
// @downloadURL         https://greasyfork.org/scripts/462440/code/bravegpt.user.js
// @updateURL           https://greasyfork.org/scripts/462440/code/bravegpt.meta.js
// @homepageURL         https://www.bravegpt.com
// @supportURL          https://github.bravegpt.com/issues
// ==/UserScript==

// NOTE: This script relies on the powerful chatgpt.js library @ https://chatgpt.js.org (c) 2023 KudoAI & contributors under the MIT license
// ...and KaTeX, the fastest math typesetting library @ https://katex.org (c) 2013â€“2020 Khan Academy & contributors under the MIT license

(async () => {

    // Define SCRIPT functions

    function loadSetting(...keys) { keys.forEach(key => { config[key] = GM_getValue(config.prefix + '_' + key, false) })}
    function saveSetting(key, value) { GM_setValue(config.prefix + '_' + key, value) ; config[key] = value }
    function safeWindowOpen(url) { window.open(url, '_blank', 'noopener') } // to prevent backdoor vulnerabilities

    function updateCheck() {

        // Fetch latest meta
        const currentVer = GM_info.script.version
        GM.xmlHttpRequest({
            method: 'GET', url: config.updateURL + '?t=' + Date.now(),
            headers: { 'Cache-Control': 'no-cache' },
            onload: (response) => {

                // Compare versions
                const latestVer = /@version +(.*)/.exec(response.responseText)[1]
                for (let i = 0 ; i < 4 ; i++) { // loop thru subver's
                    const currentSubVer = parseInt(currentVer.split('.')[i]) || 0
                    const latestSubVer = parseInt(latestVer.split('.')[i]) || 0
                    if (currentSubVer > latestSubVer) break // out of comparison since not outdated
                    else if (latestSubVer > currentSubVer) { // if outdated

                        // Alert to update
                        alert('Update available! ðŸš€',
                            `An update to BraveGPT (v${ latestVer }) is available!   `
                                + '<a target="_blank" rel="noopener" style="font-size: 0.7rem" '
                                    + 'href="' + config.gitHubURL + '/commits/main/greasemonkey/'
                                    + config.updateURL.replace(/.*\/(.*)meta\.js/, '$1user.js') + '" '
                                    + '>View changes</a>',
                            function update() { // button
                                GM_openInTab(config.updateURL.replace('meta.js', 'user.js') + '?t=' + Date.now(),
                                    { active: true, insert: true } // focus, make adjacent
                                ).onclose = () => location.reload() }
                        )
                        return
                }}

                alert('Up-to-date!', `BraveGPT (v${ currentVer }) is up-to-date!`)
    }})}

    // Define MENU functions

    function getUserscriptManager() { try { return GM_info.scriptHandler } catch (error) { return 'other' }}

    function registerMenu() {
        const menuIDs = [] // to store registered commands for removal while preserving order
        const state = {
            symbol: ['âœ”ï¸', 'âŒ'], word: ['ON', 'OFF'], notifWord: ['Enabled', 'Disabled'],
            separator: getUserscriptManager() === 'Tampermonkey' ? ' â€” ' : ': ' }

        // Add command to toggle proxy API mode
        const pamLabel = state.symbol[+!config.proxyAPIenabled] + ' Proxy API Mode '
                       + state.separator + state.word[+!config.proxyAPIenabled]
        menuIDs.push(GM_registerMenuCommand(pamLabel, function() {
            saveSetting('proxyAPIenabled', !config.proxyAPIenabled)
            notify('Proxy Mode ' + state.notifWord[+!config.proxyAPIenabled], '', '', 'shadow')
            for (const id of menuIDs) { GM_unregisterMenuCommand(id) } registerMenu() // refresh menu
            location.reload() // re-send query using new endpoint
        }))

        // Add command to toggle prefix mode
        const pmLabel = state.symbol[+!config.prefixEnabled] + ' Require "/" before query '
                      + state.separator + state.word[+!config.prefixEnabled]
        menuIDs.push(GM_registerMenuCommand(pmLabel, function() {
            saveSetting('prefixEnabled', !config.prefixEnabled)
            if (config.prefixEnabled && config.suffixEnabled) { // disable Suffix Mode if activating Prefix Mode
                saveSetting('suffixEnabled', !config.suffixEnabled) }
            notify('Prefix Mode ' + state.notifWord[+!config.prefixEnabled], '', '', 'shadow')
            for (const id of menuIDs) { GM_unregisterMenuCommand(id) } registerMenu() // refresh menu
            if (!config.prefixEnabled) location.reload() // re-send query if newly disabled
        }))

        // Add command to toggle suffix mode
        const smLabel = state.symbol[+!config.suffixEnabled] + ' Require "?" after query '
                      + state.separator + state.word[+!config.suffixEnabled]
        menuIDs.push(GM_registerMenuCommand(smLabel, function() {
            saveSetting('suffixEnabled', !config.suffixEnabled)
            if (config.prefixEnabled && config.suffixEnabled) { // disable Prefix Mode if activating Suffix Mode
                saveSetting('prefixEnabled', !config.prefixEnabled) }
            notify(config.appSymbol + ' Suffix Mode ' + state.notifWord[+!config.suffixEnabled], '', '', 'shadow')
            for (const id of menuIDs) { GM_unregisterMenuCommand(id) } registerMenu() // refresh menu
            if (!config.suffixEnabled) location.reload() // re-send query if newly disabled
        }))

        // Add command to launch About modal
        menuIDs.push(GM_registerMenuCommand('ðŸ’¡ About BraveGPT', async () => {

            // Get chatgpt.js version
            const scriptMeta = await new Promise(resolve => {
                GM.xmlHttpRequest({ method: 'GET', url: config.updateURL + '?t=' + Date.now(),
                    headers: { 'Cache-Control': 'no-cache' }, onload: resolve
            })})
            const chatgptJSver = /chatgpt-([\d\.]+)\.min/.exec(scriptMeta.responseText)?.[1] || ''

            // Show alert
            const aboutAlertID = alert(
                'BraveGPT', // title
                ' Version: ' + GM_info.script.version + '\n Powered by: ' // msg
                    + '<a href="https://chatgpt.js.org" target="_blank" rel="noopener">chatgpt.js</a>'
                    + ( chatgptJSver ? ( ' v' + chatgptJSver ) : '' ),
                [ // buttons
                    function checkForUpdates() { updateCheck() },
                    function githubSource() { safeWindowOpen(config.gitHubURL) },
                    function leaveAReview() {
                        const reviewAlertID = chatgpt.alert('Choose a platform:', '',
                            [ function greasyFork() { safeWindowOpen(
                                  config.greasyForkURL + '/feedback#post-discussion') },
                              function productHunt() { safeWindowOpen(
                                  'https://www.producthunt.com/products/bravegpt/reviews/new') },
                              function futurepedia() { safeWindowOpen(
                                  'https://www.futurepedia.io/tool/bravegpt#bravegpt-review') }])
                        document.getElementById(reviewAlertID).querySelector('button')
                            .style.display = 'none' } // hide Dismiss button
                ], '', 593) // About modal width

            // Re-format buttons to include emojis + re-case + hide 'Dismiss'
            for (const button of document.getElementById(aboutAlertID).querySelectorAll('button')) {
                if (/updates/i.test(button.textContent)) button.textContent = 'ðŸš€ Check for Updates'
                else if (/review/i.test(button.textContent)) button.textContent = 'â­ Leave a Review'
                else if (/github/i.test(button.textContent)) button.textContent = 'ðŸ–¥ï¸ GitHub source'
                else button.style.display = 'none' // hide Dismiss button
            }
        }))
    }

    // Define FEEDBACK functions

    function notify(msg, position = '', notifDuration = '', shadow = '') {
        chatgpt.notify(`${ config.appSymbol } ${ msg }`, position, notifDuration, shadow) }

    function alert(title = '', msg = '', btns = '', checkbox = '', width = '') {
        return chatgpt.alert(`${ config.appSymbol } ${ title }`, msg, btns, checkbox, width )}

    const braveGPTconsole = {
        info: function(msg) {console.info(config.appSymbol + ' BraveGPT >> ' + msg)},
        error: function(msg) {console.error(config.appSymbol + ' BraveGPT >> ERROR: ' + msg)}
    }

    function braveGPTalert(msg) {
        if (msg.includes('login')) deleteOpenAIcookies()
        braveGPTdiv.innerHTML = braveGPTalerts[msg]
            + (braveGPTalerts[msg].includes('@') ? // if msg needs login link, add it
                '<a href="https://chat.openai.com" target="_blank" rel="noopener">chat.openai.com</a> (If issue persists, try activating Proxy Mode)</p>' : '</p>')
    }

    // Define SESSION functions

    function isBlockedbyCloudflare(resp) {
        try {
            const html = new DOMParser().parseFromString(resp, 'text/html')
            const title = html.querySelector('title')
            return title.innerText === 'Just a moment...'
        } catch (error) { return false }
    }

    function deleteOpenAIcookies() {
        if (getUserscriptManager() !== 'Tampermonkey') return
        GM_cookie.list({ url: openAIendpoints.auth }, (cookies, error) => {
            if (!error) { for (const cookie of cookies) {
                GM_cookie.delete({ url: openAIendpoints.auth, name: cookie.name })
    }}})}

    function getOpenAItoken() {
        return new Promise((resolve) => {
            const accessToken = GM_getValue(config.prefix + '_openAItoken')
            braveGPTconsole.info('OpenAI access token: ' + accessToken)
            if (!accessToken) {
                GM.xmlHttpRequest({ url: openAIendpoints.session, onload: (response) => {
                    if (isBlockedbyCloudflare(response.responseText)) {
                        braveGPTalert('checkCloudflare') ; return }
                    try {
                        const newAccessToken = JSON.parse(response.responseText).accessToken
                        GM_setValue(config.prefix + '_openAItoken', newAccessToken)
                        resolve(newAccessToken)
                    } catch { braveGPTalert('login') ; return }
                }})
            } else resolve(accessToken)
    })}

    function getAIGCFkey() {
        return new Promise((resolve) => {
            const publicKey = GM_getValue(config.prefix + '_aigcfKey')
            if (!publicKey) {
                GM.xmlHttpRequest({ method: 'GET', url: 'https://api.aigcfun.com/fc/key',
                    headers: {
                        'Content-Type': 'application/json',
                        'Referer': 'https://aigcfun.com/',
                        'X-Forwarded-For': chatgpt.generateRandomIP() },
                    onload: (response) => {
                        const newPublicKey = JSON.parse(response.responseText).data
                        if (!newPublicKey) { braveGPTconsole.error('Failed to get AIGCFun public key') ; return }
                        GM_setValue(config.prefix + '_aigcfKey', newPublicKey)
                        console.info('AIGCFun public key set: ' + newPublicKey)
                        resolve(newPublicKey)
                }})
            } else resolve(publicKey)
    })}

    // Define ANSWER functions

    async function getShowReply(messages, callback) {

        // Initialize attempt properties
        if (!getShowReply.triedEndpoints) getShowReply.triedEndpoints = []
        if (!getShowReply.attemptCnt) getShowReply.attemptCnt = 0

        // Pick API
        let endpoint, accessKey, model
        if (config.proxyAPIenabled) { // randomize proxy API
            const untriedEndpoints = proxyEndpoints.filter((entry) => {
                return !getShowReply.triedEndpoints?.includes(entry[0]) })
            const entry = untriedEndpoints[Math.floor(chatgpt.randomFloat() * untriedEndpoints.length)]
            endpoint = entry[0] ; accessKey = entry[1] ; model = entry[2]
        } else { // use OpenAI API
            endpoint = openAIendpoints.chat
            const timeoutPromise = new Promise((resolve, reject) => {
                setTimeout(() => { reject(new Error('Timeout occurred')) }, 3000) })
            accessKey = await Promise.race([getOpenAItoken(), timeoutPromise])
            if (!accessKey) { braveGPTalert('login') ; return }
            model = 'text-davinci-002-render'
        }

        // Get answer from ChatGPT
        const data = JSON.stringify(
            config.proxyAPIenabled ? { messages: messages, model: model }
                                   : { action: 'next', messages: messages, model: model,
                                       parent_message_id: chatgpt.uuidv4(), max_tokens: 4000 })
        GM.xmlHttpRequest({
            method: 'POST', url: endpoint,
            headers: { 'Content-Type': 'application/json', Authorization: 'Bearer ' + accessKey },
            responseType: responseType(), data: data, onloadstart: onLoadStart(), onload: onLoad(),
            onerror: (error) => {
                braveGPTconsole.error(error)
                if (!config.proxyAPIenabled) braveGPTalert(!accessKey ? 'login' : 'suggestProxy')
                else { // if proxy mode
                    if (getShowReply.attemptCnt < proxyEndpoints.length) retryDiffHost()
                    else braveGPTalert('suggestOpenAI')
            }}
        })

        function responseType() {
            return (!config.proxyAPIenabled && getUserscriptManager() === 'Tampermonkey') ? 'stream' : 'text' }

        function retryDiffHost() {
            braveGPTconsole.error(`Error calling ${ endpoint }. Trying another endpoint...`)
            getShowReply.triedEndpoints.push(endpoint) // store current proxy to not retry
            getShowReply.attemptCnt++
            getShowReply(messages, callback)
        }

        function onLoadStart() { // process streams for unproxied TM users
            braveGPTconsole.info('Endpoint used: ' + endpoint)
            if (!config.proxyAPIenabled && getUserscriptManager() === 'Tampermonkey') {
                return (stream) => {
                    const reader = stream.response.getReader()
                    reader.read().then(function processText({ done, value }) {
                        if (done) return
                        let responseItem = String.fromCharCode(...Array.from(value))
                        const items = responseItem.split('\n\n')
                        if (items.length > 2) {
                            const lastItem = items.slice(-3, -2)[0]
                            if (lastItem.startsWith('data: [DONE]')) responseItem = items.slice(-4, -3)[0]
                            else responseItem = lastItem
                        }
                        if (responseItem.startsWith('data: {')) {
                            const answer = JSON.parse(responseItem.slice(6)).message.content.parts[0]
                            braveGPTshow(answer)
                        } else if (responseItem.startsWith('data: [DONE]')) return
                        return reader.read().then(processText)
        })}}}

        function onLoad() {
            return (event) => {
                if (event.status !== 200) {
                    braveGPTconsole.error('Event status: ' + event.status)
                    braveGPTconsole.info('Event response: ' + event.responseText)
                    if (config.proxyAPIenabled && getShowReply.attemptCnt < proxyEndpoints.length)
                        retryDiffHost()
                    else if (event.status === 401 && !config.proxyAPIenabled) {
                        GM_deleteValue(config.prefix + '_openAItoken') ; braveGPTalert('login') }
                    else if (event.status === 403)
                        braveGPTalert(config.proxyAPIenabled ? 'suggestOpenAI' : 'checkCloudflare')
                    else if (event.status === 429) braveGPTalert('tooManyRequests')
                    else braveGPTalert(config.proxyAPIenabled ? 'suggestOpenAI' : 'suggestProxy')
                } else if (!config.proxyAPIenabled && getUserscriptManager() !== 'Tampermonkey') {
                    if (event.response) {
                        try { // to parse txt response from OpenAI endpoint for non-TM users
                            const answer = JSON.parse(event.response
                                .split('\n\n').slice(-3, -2)[0].slice(6)).message.content.parts[0]
                            braveGPTshow(answer)
                        } catch (error) {
                            braveGPTconsole.error(braveGPTalerts.parseFailed + ': ' + error)
                            braveGPTconsole.info('Response: ' + event.response)
                            braveGPTalert('suggestProxy')
                        }
                    }
                } else if (config.proxyAPIenabled) {
                    if (event.responseText) {
                        try { // to parse txt response from proxy endpoints
                            const answer = JSON.parse(event.responseText).choices[0].message.content
                            braveGPTshow(answer) ; getShowReply.triedEndpoints = [] ; getShowReply.attemptCnt = 0
                        } catch (error) {
                            braveGPTconsole.info('Response: ' + event.responseText)

                            if (event.responseText.includes('finish_reason')) { // if AIGCF error encountered
                                GM_setValue(config.prefix + '_aigcfKey', false) // clear GM key for fresh getAIGCFkey()

                                // Determine index of AIGCF in endpoint map
                                let aigcfMapIndex = -1
                                for (let i = 0 ; i < proxyEndpoints.length ; i++) {
                                    const endpoint = proxyEndpoints[i]
                                    if (endpoint.some(item => item.includes('aigcfun'))) {
                                        aigcfMapIndex = i ; break
                                }}

                                // Updated AIGCF endpoint w/ fresh key (using fresh IP)
                                (async () => { // IIFE to use await
                                    proxyEndpoints[aigcfMapIndex][0] = (
                                        'https://api.aigcfun.com/api/v1/text?key=' + await getAIGCFkey())
                                    getShowReply(messages, callback) // re-fetch reply
                                })()

                            } else { // use different endpoint or suggest OpenAI
                                braveGPTconsole.error(braveGPTalerts.parseFailed + ': ' + error)
                                if (getShowReply.attemptCnt < proxyEndpoints.length) retryDiffHost()
                                else braveGPTalert('suggestOpenAI')
                            }
                        }
        }}}}
    }

    function braveGPTshow(answer) {
        braveGPTdiv.innerHTML = '<span class="prefix">ðŸ¤–  <a href="https://www.bravegpt.com" target="_blank" rel="noopener">BraveGPT</a></span><span class="kudo-ai">by <a target="_blank" href="https://github.com/kudoai" rel="noopener">KudoAI</a></span><span class="balloon-tip"></span><pre></pre><section style="margin-bottom: -47px"><form><div class="continue-chat"><textarea id="bravegpt-reply-box" rows="1" placeholder="Send reply..."></textarea><button title="Send reply"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4 mr-1" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg></button></div></form></section>'
        braveGPTdiv.querySelector('pre').textContent = answer
        fillBraveGPTfooter() ; braveGPTfooter.style.height = 'inherit' // (re-)init (after loading replies)
        braveGPTdiv.appendChild(braveGPTfooter) // append feedback link

        // Render math
        renderMathInElement(braveGPTdiv.querySelector('pre'), { // eslint-disable-line no-undef
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false},
                {left: '\\(', right: '\\)', display: false},
                {left: '\\[', right: '\\]', display: true},
                {left: '\\begin{equation}', right: '\\end{equation}', display: true},
                {left: '\\begin{align}', right: '\\end{align}', display: true},
                {left: '\\begin{alignat}', right: '\\end{alignat}', display: true},
                {left: '\\begin{gather}', right: '\\end{gather}', display: true},
                {left: '\\begin{CD}', right: '\\end{CD}', display: true},
                {left: '\\[', right: '\\]', display: true}
            ],
            throwOnError: false
        })

        // Init variables for listeners
        const form = braveGPTdiv.querySelector('form')
        const replyBox = document.getElementById('bravegpt-reply-box')
        let prevLength = replyBox.value.length

        // Add listeners
        form.addEventListener('keydown', enterToSubmit)
        form.addEventListener('submit', handleSubmit )
        replyBox.addEventListener('input', autosizeBox)

        function enterToSubmit(event) {
            if (event.key === 'Enter' && event.target.nodeName === 'TEXTAREA') handleSubmit(event) }

        function handleSubmit(event) {
            event.preventDefault()
            if (messages.length > 2) messages.splice(0, 2) // keep token usage maintainable
            const prevReplyTrimmed = braveGPTdiv.querySelector('pre').textContent.substring(0, 250 - replyBox.value.length)
            if (!config.proxyAPIenabled) {
                messages.push({ role: 'assistant', id: chatgpt.uuidv4(), content: { content_type: 'text', parts: [prevReplyTrimmed] } })
                messages.push({ role: 'user', id: chatgpt.uuidv4(), content: { content_type: 'text', parts: [replyBox.value] } })
            } else {
                messages.push({ role: 'assistant', content: prevReplyTrimmed })
                messages.push({ role: 'user', content: replyBox.value })
            } getShowReply(messages)

            // Remove listeners since they're re-added
            replyBox.removeEventListener('input', autosizeBox)
            form.removeEventListener('submit', handleSubmit)
            replyBox.removeEventListener('keydown', enterToSubmit)

            // Show loading status
            const replySection = braveGPTdiv.querySelector('section')
            replySection.classList.add('loading') ; replySection.innerHTML = ''
            braveGPTfooter.innerHTML = '' ; braveGPTfooter.style.height = '51px'
        }

        function autosizeBox() {
            const newLength = replyBox.value.length
            if (newLength < prevLength) { // if deleting txt
                replyBox.style.height = 'auto' // ...auto-fit height
                if (parseInt(getComputedStyle(replyBox).height) < 55) { // if down to one line
                    replyBox.style.height = '2.15rem' } // ...reset to original height
            }
            replyBox.style.height = replyBox.scrollHeight + 'px'
            prevLength = newLength
        }
    }

    function fillBraveGPTfooter() {
        braveGPTfooter.innerHTML = `<a class="feedback svelte-8js1iq" target="_blank" rel="noopener" href="https://github.bravegpt.com/discussions/new/choose"><svg class="icon" xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 15 15"><path fill-rule="evenodd" d="M.577 6.23a.577.577 0 1 1 0-1.153H1.5a.577.577 0 0 1 0 1.154H.577ZM2.83 8.939a.576.576 0 0 1 0 .816l-1.385 1.385a.573.573 0 0 1-.816 0 .576.576 0 0 1 0-.816l1.385-1.385a.577.577 0 0 1 .816 0ZM.63.985a.576.576 0 1 1 .815-.816L2.83 1.553a.576.576 0 1 1-.816.816L.63.985ZM15 5.654a.577.577 0 0 1-.577.577H13.5a.577.577 0 0 1 0-1.154h.923c.319 0 .577.258.577.577Zm-.631 4.669a.576.576 0 1 1-.816.816l-1.385-1.385a.576.576 0 1 1 .816-.816l1.385 1.385Zm-2.2-7.954a.576.576 0 0 1 0-.816L13.553.17a.577.577 0 0 1 .816.816l-1.385 1.384a.575.575 0 0 1-.816 0ZM9.3 9.09a.579.579 0 0 0-.045.038c-.45.417-.486 1.23-.486 1.47v.238c-1.045.45-2.053.177-2.537-.013v-.226c0-.24-.036-1.053-.487-1.469a.687.687 0 0 0-.044-.037c-.81-.609-1.777-1.667-1.777-3.253 0-2.073 1.604-3.76 3.576-3.76s3.577 1.687 3.577 3.76c0 1.586-.967 2.644-1.777 3.252Zm-1.8 4.757c-.995 0-1.223-.623-1.27-.814v-.997a4.83 4.83 0 0 0 1.343.197c.374 0 .78-.057 1.195-.18v.978c-.05.202-.282.816-1.269.816ZM7.5.923c-2.609 0-4.73 2.204-4.73 4.914 0 1.616.757 3.047 2.192 4.141.058.094.114.39.115.618v2.494c0 .03.003.06.007.09.1.63.732 1.82 2.416 1.82s2.316-1.19 2.416-1.82a.674.674 0 0 0 .006-.09v-2.494c0-.206.054-.525.11-.613 1.438-1.096 2.198-2.528 2.198-4.146 0-2.71-2.121-4.914-4.73-4.914Z" clip-rule="evenodd"></path></svg> Feedback</a>`
    }

    async function loadBraveGPT() {
        braveGPTdiv.innerHTML = '<p class="loading"></p>' // give BraveGPT container spinning loader
        const siderbarContainer = document.querySelector('#side-right')
        siderbarContainer.prepend(braveGPTdiv) // inject BraveGPT container
        const query = new URL(location.href).searchParams.get('q')
        messages.push(
            config.proxyAPIenabled ? { role: 'user', content: query }
                                   : { role: 'user', id: chatgpt.uuidv4(),
                                       content: { content_type: 'text', parts: [query] }})
        getShowReply(messages)
    }

    // Run MAIN routine

    // Init config/messages/menu
    const config = {
        prefix: 'braveGPT', appSymbol: 'ðŸ¤–', userLanguage: chatgpt.getUserLanguage(),
        gitHubURL: 'https://github.com/kudoai/bravegpt',
        greasyForkURL: 'https://greasyfork.org/scripts/462440-bravegpt' }
    config.updateURL = config.greasyForkURL + '/code/bravegpt.meta.js'
    config.assetHostURL = config.gitHubURL.replace('github.com', 'raw.githubusercontent.com') + '/main/'
    loadSetting('proxyAPIenabled', 'prefixEnabled', 'suffixEnabled')
    const messages = [] ; registerMenu()

    // Exit if prefix/suffix required but not present
    if (( config.prefixEnabled && !/.*q=%2F/.test(document.location) ) || // if prefix required but not present
        ( config.suffixEnabled && !/.*q=.*%3F(&|$)/.test(document.location) )) { // or suffix required but not present
            return }

    // Init endpoints
    const openAIendpoints = {
        auth: 'https://auth0.openai.com',
        session: 'https://chat.openai.com/api/auth/session',
        chat: 'https://chat.openai.com/backend-api/conversation' }
    const proxyEndpoints = [[ 'https://api.aigcfun.com/api/v1/text?key=' + await getAIGCFkey(), '', 'gpt-3.5-turbo' ]]

    const braveGPTalerts = {
        login: 'Please login @ ',
        tooManyRequests: 'ChatGPT is flooded with too many requests. Try switching '
            + ( config.proxyAPIenabled ? 'off' : 'on' ) + ' Proxy Mode in toolbar',
        parseFailed: 'Failed to parse response JSON. Try switching '
            + ( config.proxyAPIenabled ? 'off' : 'on' ) + ' Proxy Mode in toolbar',
        checkCloudflare: 'Please pass Cloudflare security check @ ',
        suggestProxy: 'OpenAI API is not working. Try switching on Proxy Mode in toolbar',
        suggestOpenAI: 'Proxy API is not working. Try switching off Proxy Mode in toolbar'
    }

    // Stylize elements
    const braveGPTstyle = document.createElement('style')
    braveGPTstyle.innerText = `
        .bravegpt-container { word-wrap: break-word ; white-space: pre-wrap ; margin-bottom: 20px }
        .bravegpt-container p { margin: 0 }
        .bravegpt-container .chatgpt-icon { position: relative ; bottom: -4px ; margin-right: 11px }
        .bravegpt-container .prefix { font-size: 20px ; font-family: var(--brand-font) }
        .bravegpt-container .prefix > a { color: inherit }
        .bravegpt-container .loading { color: #b6b8ba ; animation: pulse 2s cubic-bezier(.4,0,.6,1) infinite }
        .bravegpt-container pre { /* ChatGPT output box */
            /* text spacing */ white-space: pre-wrap ; line-height: 21px ;
            font-family: Consolas, Menlo, Monaco, monospace ;
            /* box spacing */ padding: 1.2em ; margin-top: .7em ; border-radius: 13px ;
            background-color: #eaeaea
        }
        .bravegpt-container .footer {
            margin: 7px 0 -26px 0 ; padding: 14px -1 !important ; font-size: var(--text-sm-2)
            justify-content: right !important ; border-top: none !important
        }
        .bravegpt-container .feedback { font-family: var(--brand-font) ; color: var(--search-text-06);
            font-size: .65rem ; letter-spacing: .02em ; line-height: 1; position: relative ; left: 222px }
        .bravegpt-container .feedback .icon { fill: currentColor ; color: currentColor ; --size:15px ; position: relative ; top: 3px ; right: 3px }
        .bravegpt-container .footer a:hover { color: black }
        @keyframes pulse { 0%, to { opacity: 1 } 50% { opacity: .5 }} `
        + '.balloon-tip { content: "" ; position: relative ; top: 0.25em ; right: 9.64rem ; border: 7px solid transparent ;'
            + 'border-bottom-style: solid ; border-bottom-width: 16px ; border-bottom-color: #eaeaea ; border-top: 0 } '
        + '.chatgpt-js { font-family: var(--brand-font) ; font-size: .65rem ; position: relative ; right: .9rem } '
        + '.chatgpt-js > a { color: inherit ; top: .054rem } '
        + '.chatgpt-js > svg { top: 3px ; position: relative ; margin-right: 1px } '
        + '.continue-chat > textarea { border: none ; border-radius: 15px 16px 15px 0 ; margin: -6px 0 5px 0 ;  padding: 9px 0 5px 10px ; '
            + 'background: #eeeeee70 ; height: 2.15rem ; width: 100% ; max-height: 200px ; resize: none ;  } '
        + '.continue-chat > button { position: relative ; bottom: 54px; left: 299px; border: none ; margin: 13px 4px 0 0 ; '
            + 'background: none ; color: lightgrey ; cursor: pointer } '
        + '.kudo-ai { margin-left: 7px ; font-size: .65rem ; color: #aaa } '
        + '.kudo-ai a { color: #aaa ; text-decoration: none } '
        + '.kudo-ai a:hover { color: black ; text-decoration: none } '
        + '.katex-html { display: none } ' // hide unrendered math
        + '.chatgpt-modal p { font-size: 1.115rem ; margin-left: 4px } ' // chatgpt.alert() msg
        + '.chatgpt-modal button { ' // chatgpt.alert() buttons
            + 'padding: 8px 15px !important ; border-radius: 0 !important ; border: 2px solid black !important } '
    document.head.appendChild(braveGPTstyle) // append style to <head>

    // Create BraveGPT container & add id/classes
    const braveGPTdiv = document.createElement('div') // create container div
    braveGPTdiv.setAttribute('id', 'infobox')
    braveGPTdiv.setAttribute( // assign Brave's .snippet + custom class
        'class', 'snippet bravegpt-container')

    // Create feedback footer & add class
    const braveGPTfooter = document.createElement('div') // create footer div
    braveGPTfooter.className = 'footer'

    // Activate promo campaign if active
    GM.xmlHttpRequest({
        method: 'GET', url: config.assetHostURL + 'ads/live/creative.html',
        onload: (response) => { if (response.status == 200) {

                // Create campaign div & add class/style/HTML
                const pcDiv = document.createElement('div')
                pcDiv.setAttribute( // assign Brave's .snippet + custom class
                    'class', 'snippet bravegpt-container')
                pcDiv.style.display = 'flex'
                pcDiv.style.padding = '17px 19px 21px 23px'
                pcDiv.innerHTML = response.responseText

                // Inject in sidebar
                braveGPTdiv.insertAdjacentElement('afterend', pcDiv)
    }}})

    loadBraveGPT()

})()
