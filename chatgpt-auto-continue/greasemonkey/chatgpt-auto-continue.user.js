// ==UserScript==
// @name                ChatGPT Auto-Continue â©
// @name:ar             ChatGPT Ø§Ø³ØªÙ…Ø±Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠ â©
// @name:bg             ChatGPT ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡Ð½Ð¾ Ð¿Ñ€Ð¾Ð´ÑŠÐ»Ð¶Ð°Ð²Ð°Ð½Ðµ â©
// @name:bn             à¦šà§à¦¯à¦¾à¦Ÿà¦œà¦¿à¦ªà¦¿à¦Ÿà¦¿ à¦¸à§à¦¬à¦¯à¦¼à¦‚à¦•à§à¦°à¦¿à¦¯à¦¼ à¦šà¦¾à¦²à¦¿à¦¯à¦¼à§‡ à¦¯à¦¾à¦¨ â©
// @name:cs             ChatGPT AutomatickÃ© pokraÄovÃ¡nÃ­ â©
// @name:da             ChatGPT Auto-FortsÃ¦t â©
// @name:de             ChatGPT Automatisches Weitermachen â©
// @name:el             ChatGPT Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î£Ï…Î½Î­Ï‡ÎµÎ¹Î± â©
// @name:eo             ChatGPT AÅ­tomata DaÅ­rigado â©
// @name:es             ChatGPT ContinuaciÃ³n AutomÃ¡tica â©
// @name:fi             ChatGPT Automaattinen Jatkaminen â©
// @name:fr             ChatGPT Auto-Continuation â©
// @name:fr-CA          ChatGPT Auto-Continuation â©
// @name:gu             àªšà«‡àªŸàªœà«€àªªà«€àªŸà«€ àª¸à«àªµàªšàª¾àª²àª¿àª¤ àªšàª¾àª²à« àª°àª¾àª–à«‹ â©
// @name:hi             à¤šà¥ˆà¤Ÿà¤œà¥€à¤ªà¥€à¤Ÿà¥€ à¤¸à¥à¤µà¤šà¤¾à¤²à¤¿à¤¤ à¤œà¤¾à¤°à¥€ à¤°à¤–à¥‡à¤‚ â©
// @name:hu             ChatGPT Automatikus FolytatÃ¡s â©
// @name:in             ChatGPT Lanjutan Otomatis â©
// @name:it             ChatGPT Continuazione Automatica â©
// @name:iw             ×¦'××˜×’×¤×˜ ×”×ž×©×š ××•×˜×•×ž×˜×™ â©
// @name:ja             ChatGPT è‡ªå‹•ç¶™ç¶š â©
// @name:ka             ChatGPT áƒáƒ•áƒ¢áƒáƒ›áƒáƒ¢áƒ£áƒ áƒ˜ áƒ’áƒáƒ’áƒ áƒ«áƒ”áƒšáƒ”áƒ‘áƒ â©
// @name:kn             à²šà²¾à²Ÿà³à²œà²¿à²ªà²¿à²Ÿà²¿ à²¸à³à²µà²¯à²‚à²šà²¾à²²à²¿à²¤ à²®à³à²‚à²šà²¿à²¤à²µà²¾à²—à²¿à²¸à²¿ â©
// @name:ko             ChatGPT ìžë™ ê³„ì†í•˜ê¸° â©
// @name:ku             ChatGPT Berdewamkirina Otonom â©
// @name:ml             à´šà´¾à´±àµà´±àµâ€Œà´œà´¿à´ªà´¿à´Ÿà´¿ à´“à´Ÿàµà´Ÿàµ‹-à´¤àµà´Ÿà´™àµà´™àµ½ â©
// @name:mr             à¤šà¥…à¤Ÿà¤œà¥€à¤ªà¥€à¤Ÿà¥€ à¤¸à¥à¤µà¤¯à¤‚à¤šà¤²à¤¿à¤¤ à¤¸à¥à¤°à¥‚ à¤ à¥‡à¤µà¤¾ â©
// @name:ms             ChatGPT Sambungan Auto â©
// @name:my             ChatGPT á€¡á€œá€­á€¯á€¡á€œá€»á€±á€¬á€€á€ºá€…á€€á€ºá€™á€¾á€”á€ºá€•á€¼á€á€ºá€žá€€á€ºá€›á€±á€¬á€€á€ºá€žá€Šá€º â©
// @name:nl             ChatGPT Automatisch Doorgaan â©
// @name:no             ChatGPT Automatisk Fortsette â©
// @name:or             à¬šà¬¾à¬Ÿà¬œà¬¿à¬ªà¬¿à¬Ÿà¬¿ à¬¸à­à­±à­Ÿà¬‚à¬šà¬¾à¬³à¬¿à¬¤ à¬šà¬¾à¬²à¬¨à­à¬¤à­ â©
// @name:pa             à¨šà©ˆà¨Ÿà¨œà©€à¨ªà©€à¨Ÿà©€ à¨†à¨Ÿà©‹-à¨•à©°à¨Ÿà©€à¨¨à¨¿à¨Š à¨•à¨°à©‹ â©
// @name:pl             ChatGPT Automatyczne Kontynuowanie â©
// @name:pt             ChatGPT ContinuaÃ§Ã£o AutomÃ¡tica â©
// @name:pt-BR          ChatGPT ContinuaÃ§Ã£o AutomÃ¡tica â©
// @name:ro             ChatGPT Auto-Continuare â©
// @name:ru             ChatGPT ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶ÐµÐ½Ð¸Ðµ â©
// @name:sk             ChatGPT AutomatickÃ© PokraÄovanie â©
// @name:sr             ChatGPT ÐÑƒÑ‚Ð¾Ð¼Ð°Ñ‚ÑÐºÐ¾ Ð½Ð°ÑÑ‚Ð°Ð²Ð°Ðº â©
// @name:ta             à®šà®¾à®Ÿà¯ à®œà®¿à®ªà®¿à®Ÿà®¿ à®¤à®¾à®©à®¿à®¯à®™à¯à®•à®¿ à®¤à¯Šà®Ÿà®™à¯à®•à®²à¯ â©
// @name:th             ChatGPT à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£à¸•à¹ˆà¸­à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´ â©
// @name:tr             ChatGPT Otomatik Devam Etme â©
// @name:uk             ChatGPT ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡Ð½Ðµ ÐŸÑ€Ð¾Ð´Ð¾Ð²Ð¶ÐµÐ½Ð½Ñ â©
// @name:ur             Ú†ÛŒÙ¹ Ø¬ÛŒ Ù¾ÛŒ Ù¹ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¬Ø§Ø±ÛŒ Ø±Ú©Ú¾ÛŒÚº â©
// @name:vi             ChatGPT Tá»± Äá»™ng Tiáº¿p Tá»¥c â©
// @name:zh-CN          ChatGPT è‡ªåŠ¨ç»§ç»­ â©
// @name:zh-HK          ChatGPT è‡ªå‹•ç¹¼çºŒ â©
// @name:zh-SG          ChatGPT è‡ªåŠ¨ç»§ç»­ â©
// @name:zh-TW          ChatGPT è‡ªå‹•ç¹¼çºŒ â©
// @version             2023.5.23
// @description         âš¡ Automatically continue generating multiple ChatGPT responses
// @description:ar      âš¡ Ø§Ø³ØªÙ…Ø± ÙÙŠ ØªÙˆÙ„ÙŠØ¯ Ø¥Ø¬Ø§Ø¨Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø© Ù…Ù† ChatGPT ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
// @description:bg      âš¡ ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡Ð½Ð¾ Ð¿Ñ€Ð¾Ð´ÑŠÐ»Ð¶Ð°Ð²Ð°Ð½Ðµ Ð½Ð° Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð°Ð½ÐµÑ‚Ð¾ Ð½Ð° Ð¼Ð½Ð¾Ð¶ÐµÑÑ‚Ð²Ð¾ Ð¾Ñ‚Ð³Ð¾Ð²Ð¾Ñ€Ð¸ Ð¾Ñ‚ ChatGPT
// @description:bn      âš¡ à¦…à¦Ÿà§‹-à¦šà¦¾à¦²à¦¿à¦¤ à¦®à¦¾à¦²à§à¦Ÿà¦¿à¦ªà¦² à¦šà§à¦¯à¦¾à¦Ÿà¦œà¦¿à¦ªà¦¿à¦Ÿà¦¿ à¦‰à¦¤à§à¦¤à¦° à¦¤à§ˆà¦°à¦¿ à¦•à¦°à¦¾
// @description:cs      âš¡ AutomatickÃ© pokraÄovÃ¡nÃ­ v generovÃ¡nÃ­ vÃ­ce odpovÄ›dÃ­ od ChatGPT
// @description:da      âš¡ Auto-fortsÃ¦t med at generere flere ChatGPT-svar
// @description:de      âš¡ Automatisches Fortsetzen der Generierung mehrerer ChatGPT-Antworten
// @description:el      âš¡ Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· ÏƒÏ…Î½Î­Ï‡Î¹ÏƒÎ· Ï€Î±ÏÎ±Î³Ï‰Î³Î®Ï‚ Ï€Î¿Î»Î»Î±Ï€Î»ÏŽÎ½ Î±Ï€Î±Î½Ï„Î®ÏƒÎµÏ‰Î½ Î±Ï€ÏŒ Ï„Î¿ ChatGPT
// @description:eo      âš¡ AÅ­tomata daÅ­rigado de generado de pluraj respondoj de ChatGPT
// @description:es      âš¡ ContinuaciÃ³n automÃ¡tica generando mÃºltiples respuestas de ChatGPT
// @description:fi      âš¡ Automaattinen jatkuva useiden ChatGPT-vastausten generointi
// @description:fr      âš¡ GÃ©nÃ©ration automatique continue de multiples rÃ©ponses ChatGPT
// @description:fr-CA   âš¡ GÃ©nÃ©ration automatique continue de multiples rÃ©ponses ChatGPT
// @description:gu      âš¡ àª†àªªàª®à«‹-àªšàª¾àª²à«‡àª²à«‹ àª®àª²à«àªŸà«€àªªàª² àªšà«‡àªŸàªœà«€àªªà«€àªŸà«€ àªœàªµàª¾àª¬à«‹ àªœàª¨àª°à«‡àªŸ àª•àª°àªµà«‹
// @description:hi      âš¡ à¤‘à¤Ÿà¥‹-à¤œà¤¾à¤°à¥€ à¤…à¤¨à¥‡à¤• ChatGPT à¤‰à¤¤à¥à¤¤à¤°à¥‹à¤‚ à¤•à¤¾ à¤‰à¤¤à¥à¤ªà¤¾à¤¦à¤¨ à¤•à¤°à¥‡à¤‚
// @description:hu      âš¡ Automatikus folyamatos ChatGPT vÃ¡laszok generÃ¡lÃ¡sa
// @description:in      âš¡ Lanjutkan menghasilkan banyak jawaban ChatGPT secara otomatis
// @description:it      âš¡ Continua automaticamente a generare molteplici risposte ChatGPT
// @description:iw      âš¡ ×”×ž×©×š ××•×˜×•×ž×˜×™ ×œ×™×¦×™×¨×ª ×ž×¡×¤×¨ ×ª×©×•×‘×•×ª ×ž×¨×•×‘×•×ª ×©×œ ChatGPT
// @description:ja      âš¡ ChatGPT ã®è¤‡æ•°ã®å›žç­”ã‚’è‡ªå‹•ã§ç¶™ç¶šçš„ã«ç”Ÿæˆ
// @description:ka      âš¡ áƒáƒ•áƒ¢áƒáƒ›áƒáƒ¢áƒ£áƒ áƒáƒ“ áƒ’áƒáƒ’áƒ”áƒ‘.
// @description:kn      âš¡ à²šà²¾à²Ÿà³à²œà²¿à²ªà²¿à²Ÿà²¿ à²¬à²¹à³à²¤à²°à²¦ à²ªà³à²°à²¤à²¿à²—à²³à²¨à³à²¨à³ à²¸à³à²µà²¯à²‚à²šà²¾à²²à²¿à²¤à²µà²¾à²—à²¿ à²®à³à²‚à²šà²¿à²¤à²µà²¾à²—à²¿à²¸à³à²µà³à²¦à³
// @description:ko      âš¡ ChatGPT ë‹¤ì¤‘ ì‘ë‹µ ìžë™ ìƒì„± ê³„ì†í•˜ê¸°
// @description:ku      âš¡ Berdewamkirina Otonom a ChatGPT-Ãª jiberÃ®ne
// @description:ml      âš¡ à´šà´¾à´±àµà´±àµâ€Œà´œà´¿à´ªà´¿à´Ÿà´¿ à´ªà´²à´ªàµà´ªàµ‡à´¾à´´àµà´‚ à´‰à´¤àµà´¤à´°à´™àµà´™àµ¾ à´¸àµà´µà´¯à´‚à´šà´¾à´²à´¿à´¤à´®à´¾à´¯à´¿ à´¤àµà´Ÿà´™àµà´™àµà´•
// @description:mr      âš¡ à¤šà¥…à¤Ÿà¤œà¥€à¤ªà¥€à¤Ÿà¥€ à¤¸à¥à¤µà¤¯à¤‚à¤šà¤²à¤¿à¤¤à¤ªà¤£à¥‡ à¤ªà¥à¤°à¤¾à¤°à¤‚à¤­ à¤•à¤°à¤¾
// @description:ms      âš¡ Sambungan Auto menghasilkan banyak respons ChatGPT
// @description:my      âš¡ ChatGPT á€¡á€œá€­á€¯á€¡á€œá€»á€±á€¬á€€á€ºá€…á€€á€ºá€™á€¾á€”á€ºá€•á€¼á€á€ºá€žá€€á€ºá€›á€±á€¬á€€á€ºá€á€¼á€„á€ºá€¸
// @description:nl      âš¡ ChatGPT Automatisch Doorgaan met het genereren van meerdere reacties
// @description:no      âš¡ ChatGPT Automatisk Fortsette generering av flere svar
// @description:or      âš¡ à¬šà¬¾à¬Ÿà¬œà¬¿à¬ªà¬¿à¬Ÿà¬¿ à¬¸à­à­±à­Ÿà¬‚à¬šà¬¾à¬³à¬¿à¬¤ à¬¬à¬¹à­à¬¤à¬° à¬ªà­à¬°à¬¤à¬¿à¬­à¬¾ à¬‰à¬¤à­à¬ªà¬¾à¬¦à¬¨ à¬•à¬°à¬¨à­à¬¤à­
// @description:pa      âš¡ à¨šà©ˆà¨Ÿà¨œà©€à¨ªà©€à¨Ÿà©€ à¨†à¨Ÿà©‹-à¨•à©°à¨Ÿà©€à¨¨à¨¿à¨Š à¨•à¨°à©‹ à¨¬à¨¹à©à¨¤ à¨¸à¨¾à¨°à©‡ à¨œà¨µà¨¾à¨¬ à¨¦à©€ à¨ªà©ˆà¨¦à¨¾à¨µà¨¾à¨°
// @description:pl      âš¡ ChatGPT Automatycznie Kontynuuj generowanie wielu odpowiedzi
// @description:pt      âš¡ ChatGPT ContinuaÃ§Ã£o AutomÃ¡tica da geraÃ§Ã£o de vÃ¡rias respostas
// @description:pt-BR   âš¡ ChatGPT ContinuaÃ§Ã£o AutomÃ¡tica da geraÃ§Ã£o de vÃ¡rias respostas
// @description:ro      âš¡ ChatGPT Continuare automatÄƒ generarea de mai multe rÄƒspunsuri
// @description:ru      âš¡ ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶ÐµÐ½Ð¸Ðµ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¸Ñ… Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð² ChatGPT
// @description:sk      âš¡ ChatGPT Automaticky PokraÄujte v generovanÃ­ viacerÃ½ch odpovedÃ­
// @description:sr      âš¡ ÐÑƒÑ‚Ð¾Ð¼Ð°Ñ‚ÑÐºÐ¸ Ð½Ð°ÑÑ‚Ð°Ð²Ð°Ðº Ð³ÐµÐ½ÐµÑ€Ð¸ÑÐ°ÑšÐ° Ð²Ð¸ÑˆÐµ Ð¾Ð´Ð³Ð¾Ð²Ð¾Ñ€Ð° Ð§Ð°Ñ‚Ð“ÐŸÐ¢
// @description:ta      âš¡ à®ªà®² à®ªà®¤à®¿à®µà¯à®•à®³à¯ˆà®¤à¯ à®¤à®¾à®©à®¿à®¯à®™à¯à®•à®¿ à®‰à®°à¯à®µà®¾à®•à¯à®•à¯à®®à¯ à®šà®¾à®Ÿà¯ à®œà®¿à®ªà®¿à®Ÿà®¿ à®¤à¯Šà®Ÿà®™à¯à®•à®²à¯
// @description:th      âš¡ ChatGPT à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£à¸•à¹ˆà¸­à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´à¹ƒà¸™à¸à¸²à¸£à¸ªà¸£à¹‰à¸²à¸‡à¸„à¸³à¸•à¸­à¸šà¸«à¸¥à¸²à¸¢à¸£à¸²à¸¢à¸à¸²à¸£
// @description:tr      âš¡ ChatGPT Otomatik Devam Etme Ã‡oklu YanÄ±t Ãœretme
// @description:uk      âš¡ ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡Ð½Ðµ Ð¿Ñ€Ð¾Ð´Ð¾Ð²Ð¶ÐµÐ½Ð½Ñ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ñ–Ñ— ÐºÑ–Ð»ÑŒÐºÐ¾Ñ… Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´ÐµÐ¹ ChatGPT
// @description:ur      âš¡ Ú†ÛŒÙ¹ Ø¬ÛŒ Ù¾ÛŒ Ù¹ÛŒ Ù…ØªØ¹Ø¯Ø¯ Ø¬ÙˆØ§Ø¨Ø§Øª Ú©ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± ØªÛŒØ§Ø±ÛŒ Ø¬Ø§Ø±ÛŒ Ø±Ú©Ú¾ÛŒÚº
// @description:vi      âš¡ ChatGPT Tá»± Äá»™ng Tiáº¿p Tá»¥c táº¡o nhiá»u cÃ¢u tráº£ lá»i
// @description:zh-CN   âš¡ è‡ªåŠ¨ç»§ç»­ç”Ÿæˆå¤šä¸ª ChatGPT å“åº”
// @description:zh-HK   âš¡ è‡ªå‹•ç¹¼çºŒç”Ÿæˆå¤šå€‹ ChatGPT éŸ¿æ‡‰
// @description:zh-SG   âš¡ è‡ªåŠ¨ç»§ç»­ç”Ÿæˆå¤šä¸ª ChatGPT å“åº”
// @description:zh-TW   âš¡ è‡ªå‹•ç¹¼çºŒç”Ÿæˆå¤šå€‹ ChatGPT éŸ¿æ‡‰
// @author              Adam Lui
// @namespace           https://github.com/adamlui
// @license             MIT
// @match               https://chat.openai.com/*
// @icon                https://raw.githubusercontent.com/adamlui/userscripts/master/chatgpt/media/icons/openai-favicon48.png
// @icon64              https://raw.githubusercontent.com/adamlui/userscripts/master/chatgpt/media/icons/openai-favicon64.png
// @require             https://cdn.jsdelivr.net/gh/chatgptjs/chatgpt.js@744003f7589935a1027840a8be65239696efd05a/dist/chatgpt-1.7.1.min.js
// @connect             raw.githubusercontent.com
// @grant               GM_setValue
// @grant               GM_getValue
// @grant               GM_registerMenuCommand
// @grant               GM_unregisterMenuCommand
// @grant               GM.xmlHttpRequest
// @noframes
// @updateURL           https://greasyfork.org/scripts/466789/code/chatgpt-auto-continue.meta.js
// @downloadURL           https://greasyfork.org/scripts/466789/code/chatgpt-auto-continue.user.js
// @homepageURL         https://github.com/adamlui/chatgpt-auto-continue
// @supportURL          https://github.com/adamlui/chatgpt-auto-continue/issues
// ==/UserScript==

// NOTE: This script relies on the powerful chatgpt.js library @ https://chatgpt.js.org (c) 2023 KudoAI & contributors under the MIT license.

(async () => {

    // Initialize settings
    var appSymbol = 'â‰«', configKeyPrefix = 'chatGPTactn_'
    var config = { userLanguage: navigator.languages[0] || navigator.language || '' }
    loadSetting('lastCheckTime', 'notifHidden', 'skipNextUpdate', 'skippedVer')

    // Define messages
    var msgsLoaded = new Promise(resolve => {
        var msgHostDir = 'https://raw.githubusercontent.com/adamlui/chatgpt-auto-continue/main/greasemonkey/_locales/'
        var msgLocaleDir = ( config.userLanguage ? config.userLanguage.replace('-', '_') : 'en' ) + '/'
        var msgHref = msgHostDir + msgLocaleDir + 'messages.json' // build src link
        var msgXHRtries = 0
        GM.xmlHttpRequest({ method: 'GET', url: msgHref, onload: onLoad })
        function onLoad(response) {
            try { // to return localized messages.json
                var messages = new Proxy(JSON.parse(response.responseText), {
                    get(target, prop) { // remove need to ref nested keys
                        if (typeof target[prop] === 'object' && target[prop] !== null && 'message' in target[prop]) {
                            return target[prop].message
                }}}) ; resolve(messages)
            } catch (error) { // if 404
                msgXHRtries++ ; if (msgXHRtries == 3) return // try up to 3X (original/region-stripped/EN) only
                msgHref = config.userLanguage.includes('-') && msgXHRtries == 1 ? // if regional lang on 1st try...
                    msgHref.replace(/(.*)_.*(\/.*)/, '$1$2') // ...strip region before retrying
                        : ( msgHostDir + 'en/messages.json' ) // else use default English messages
                GM.xmlHttpRequest({ method: 'GET', url: msgHref, onload: onLoad })
            }
        }
    }) ; var messages = await msgsLoaded

    await chatgpt.isLoaded()

    // Init/register menu
    var menuIDs = [], state = { symbol: ['âœ”ï¸', 'âŒ'], word: ['ON', 'OFF'] } // initialize menu vars
    registerMenu() // create browser toolbar menu

    // Check for update (1x/48h)
    if (!config.lastCheckTime || Date.now() - config.lastCheckTime > 172800000) { // if 48h since last check

        // Fetch latest meta
        var updateURL = GM_info.scriptUpdateURL || GM_info.script.updateURL || GM_info.script.downloadURL
        fetch(updateURL + '?t=' + Date.now(), { cache: 'no-cache' })
            .then((response) => { response.text().then((data) => {
                saveSetting('lastCheckTime', Date.now())

                // Compare versions
                var currentVer = GM_info.script.version
                var latestVer = data.match(/@version +(.*)/)[1]
                if (config.skipNextUpdate && latestVer === config.skippedVer) return // exit comparison if past alert hidden
                for (var i = 0 ; i < 4 ; i++) { // loop thru subver's
                    if (parseInt(latestVer.split('.')[i] || 0) > parseInt(currentVer.split('.')[i] || 0)) { // if outdated

                        // Alert to update
                        var updateAlertID = chatgpt.alert(`${ appSymbol } ${ messages.alert_updateAvail }! ðŸš€`,
                            `${ messages.alert_newerVer } ${ messages.appName } (v${ currentVer }) ${ messages.alert_isAvail }!`
                                + `<a target="_blank" href="https://github.com/adamlui/chatgpt-auto-continue/commits/main/greasemonkey/chatgpt-auto-continue.user.js" style="font-size: 0.7rem ; position: relative ; left: 8px">${ messages.link_viewChanges }</a>`,
                            function update() { // button
                                saveSetting('skipNextUpdate', false) // reset hidden alert setting
                                window.open(( updateURL.includes('.meta.') ? GM_info.script.downloadURL : updateURL )
                                    + '?t=' + Date.now(), '_blank') },
                            function dontShowAgainUntilNextUpdate() { // checkbox
                                saveSetting('skipNextUpdate', !config.skipNextUpdate)
                                saveSetting('skippedVer', config.skipNextUpdate ? latestVer : false) }
                        )

                        // Internationalize button/checkbox labels if needed
                        if (!config.userLanguage.startsWith('en')) {
                            var updateAlert = document.querySelector(`[id="${ updateAlertID }"]`)
                            updateAlert.querySelector('label').textContent = ( // checkbox label
                                `${ messages.alert_dontShowAgain } ${ messages.alert_untilNextVer }`)
                            updateAlert.querySelectorAll('button')[1].textContent = messages.buttonLabel_update
                            updateAlert.querySelectorAll('button')[0].textContent = messages.buttonLabel_dismiss
                        }

                        return
    }}})})}

    // Observe DOM for need to continue generating response
    const continueObserver = new MutationObserver((mutationsList) => {
        for (const mutation of mutationsList) {
            if (mutation.type === 'childList') {
                for (const addedNode of mutation.addedNodes) {
                    if (addedNode.nodeName === 'BUTTON' && addedNode.innerHTML.includes('Continue generating')) {
                        addedNode.click()
    }}}}})
    continueObserver.observe(document, { childList: true, subtree: true })

    // Notify of status on load
    if (!config.notifHidden) {
        chatgpt.notify(appSymbol + ' ' + messages.mode_autoContinue + ': ON',
            '', '', chatgpt.isDarkMode() ? '' : 'shadow' )}

    // Define SCRIPT functions

    function registerMenu() {
        menuIDs = [] // empty to store newly registered cmds for removal while preserving order
        var stateSeparator = getUserscriptManager() === 'Tampermonkey' ? ' â€” ' : ': '

        // Add command to hide/show notifications on load
        var mnLabel = state.symbol[+config.notifHidden] + ' ' + messages.menuLabel_modeNotifs
                    + stateSeparator + state.word[+config.notifHidden]
        menuIDs.push(GM_registerMenuCommand(mnLabel, function() {
            saveSetting('notifHidden', !config.notifHidden)
            chatgpt.notify(appSymbol + ' ' + messages.menuLabel_modeNotifs + ': ' + state.word[+config.notifHidden],
                '', '', chatgpt.isDarkMode() ? '' : 'shadow')
            for (var i = 0 ; i < menuIDs.length ; i++) GM_unregisterMenuCommand(menuIDs[i]) // remove all cmd's
            registerMenu() // serve fresh one
        }))
    }

    function getUserscriptManager() {
        try { return GM_info.scriptHandler } catch (error) { return 'other' }}

    function loadSetting(...keys) {
        keys.forEach(key => {
            config[key] = GM_getValue(configKeyPrefix + key, false)
    })}

    function saveSetting(key, value) {
        GM_setValue(configKeyPrefix + key, value) // save to browser
        config[key] = value // and memory
    }

})()
