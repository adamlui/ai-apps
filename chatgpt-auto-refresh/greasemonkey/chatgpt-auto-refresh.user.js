// ==UserScript==
// @name                ChatGPT Auto Refresh ‚Üª
// @name:ar             ÿ™ÿ≠ÿØŸäÿ´ ÿ™ŸÑŸÇÿßÿ¶Ÿä ŸÑŸÄ ChatGPT ‚Üª
// @name:bg             –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–ø—Ä–µ—Å–Ω—è–≤–∞–Ω–µ –Ω–∞ ChatGPT ‚Üª
// @name:bn             ChatGPT ‡¶Ö‡¶ü‡ßã ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‚Üª
// @name:cs             Automatick√© obnoven√≠ ChatGPT ‚Üª
// @name:da             ChatGPT Auto Refresh ‚Üª
// @name:de             Automatische ChatGPT-Aktualisierung ‚Üª
// @name:el             ŒëœÖœÑœåŒºŒ±œÑŒ∑ Œ±ŒΩŒ±ŒΩŒ≠œâœÉŒ∑ ChatGPT ‚Üª
// @name:eo             ChatGPT A≈≠tomata Refre≈ùigo ‚Üª
// @name:es             Actualizaci√≥n Autom√°tica de ChatGPT ‚Üª
// @name:fi             ChatGPT automaattinen p√§ivitys ‚Üª
// @name:fr             Actualisation Automatique de ChatGPT ‚Üª
// @name:fr-CA          Actualisation Automatique de ChatGPT ‚Üª
// @name:gu             ChatGPT ‡™ì‡™ü‡´ã ‡™∞‡™ø‡™´‡´ç‡™∞‡´á‡™∂ ‚Üª
// @name:hi             ‡§ö‡•à‡§ü‡§ú‡•Ä‡§™‡•Ä‡§ü‡•Ä ‡§ë‡§ü‡•ã ‡§∞‡§ø‡§´‡•ç‡§∞‡•á‡§∂ ‚Üª
// @name:hu             ChatGPT automatikus friss√≠t√©se ‚Üª
// @name:in             Penyegaran Otomatis ChatGPT ‚Üª
// @name:it             Aggiornamento Automatico ChatGPT ‚Üª
// @name:iw             ◊®◊¢◊†◊ï◊ü ◊ê◊ï◊ò◊ï◊û◊ò◊ô ◊©◊ú ChatGPT ‚Üª
// @name:ja             ChatGPT Ëá™ÂãïÊõ¥Êñ∞ ‚Üª
// @name:ka             ChatGPT ·Éê·Éï·É¢·Éù·Éõ·Éê·É¢·É£·É†·Éò ·Éí·Éê·Éú·Éê·ÉÆ·Éö·Éî·Éë·Éê ‚Üª
// @name:kn             ChatGPT ‡≤∏‡≥ç‡≤µ‡≤Ø‡≤Ç ‡≤∞‡≤ø‡≤´‡≥ç‡≤∞‡≥Ü‡≤∂‡≥ç ‚Üª
// @name:ko             ChatGPT ÏûêÎèô ÏÉàÎ°ú Í≥†Ïπ® ‚Üª
// @name:ku             ChatGPT Xweseriya N√ªvekirina ‚Üª
// @name:ml             ChatGPT ‡¥Ø‡¥æ‡¥®‡µç‡¥§‡µç‡¥∞‡¥ø‡¥ï ‡¥™‡µÅ‡¥§‡µÅ‡¥ï‡µç‡¥ï‡µΩ ‚Üª
// @name:mr             ChatGPT ‡§ë‡§ü‡•ã ‡§∞‡§ø‡§´‡•ç‡§∞‡•á‡§∂ ‚Üª
// @name:ms             Segar Semula AutoGPT ‚Üª
// @name:my             ChatGPT ·Ä°·Äú·Ä≠·ÄØ·Ä°·Äú·Äª·Ä±·Ä¨·ÄÄ·Ä∫·Äï·Äº·Äî·Ä∫·Äú·Ää·Ä∫·ÄÖ·Äê·ÄÑ·Ä∫·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏ ‚Üª
// @name:nl             ChatGPT automatisch vernieuwen ‚Üª
// @name:no             ChatGPT Auto Refresh ‚Üª
// @name:or             ChatGPT ‡¨Ö‡¨ü‡≠ã ‡¨∏‡¨§‡≠á‡¨ú ‚Üª
// @name:pa             ‡®ö‡©à‡®ü‡®ú‡©Ä‡®™‡©Ä‡®ü‡©Ä ‡®Ü‡®ü‡©ã ‡®∞‡®ø‡®´‡©ç‡®∞‡©à‡®∏‡®º ‚Üª
// @name:pl             Automatyczne od≈õwie≈ºanie ChatGPT ‚Üª
// @name:pt             Atualiza√ß√£o autom√°tica do ChatGPT ‚Üª
// @name:pt-BR          Atualiza√ß√£o autom√°tica do ChatGPT ‚Üª
// @name:ro             Actualizare automatƒÉ ChatGPT ‚Üª
// @name:ru             –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ChatGPT ‚Üª
// @name:sk             Automatick√© obnovenie chatGPT ‚Üª
// @name:sr             –ê—É—Ç–æ–º–∞—Ç—Å–∫–æ –æ—Å–≤–µ–∂–∞–≤–∞—ö–µ –¶—Ö–∞—Ç–ì–ü–¢ ‚Üª
// @name:ta             ChatGPT ‡Æ§‡Ææ‡Æ©‡Æø‡ÆØ‡Æô‡Øç‡Æï‡ØÅ ‡Æ™‡ØÅ‡Æ§‡ØÅ‡Æ™‡Øç‡Æ™‡Æø‡Æ™‡Øç‡Æ™‡ØÅ ‚Üª
// @name:th             ChatGPT ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‚Üª
// @name:tr             ChatGPT Otomatik Yenileme ‚Üª
// @name:uk             –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è ChatGPT ‚Üª
// @name:ur             ⁄Ü€åŸπ ÿ¨€å Ÿæ€å Ÿπ€å ÿ¢ŸπŸà ÿ±€åŸÅÿ±€åÿ¥ ‚Üª
// @name:vi             T·ª± ƒë·ªông l√†m m·ªõi ChatGPT ‚Üª
// @name:zh-CN          ChatGPT Ëá™Âä®Âà∑Êñ∞ ‚Üª
// @name:zh-HK          ChatGPT Ëá™ÂãïÂà∑Êñ∞ ‚Üª
// @name:zh-SG          ChatGPT Ëá™Âä®Âà∑Êñ∞ ‚Üª
// @name:zh-TW          ChatGPT Ëá™ÂãïÂà∑Êñ∞ ‚Üª
// @version             2023.6.9.1
// @description         *SAFELY* keeps ChatGPT sessions fresh, eliminating constant network errors + Cloudflare checks (all from the background!)
// @author              Adam Lui
// @namespace           https://github.com/adamlui
// @description:ar      *SAFELY* Ÿäÿ≠ÿßŸÅÿ∏ ÿπŸÑŸâ ÿ¨ŸÑÿ≥ÿßÿ™ ChatGPT ÿ¨ÿØŸäÿØÿ© ÿå ŸàŸäŸÇÿ∂Ÿä ÿπŸÑŸâ ÿ£ÿÆÿ∑ÿßÿ° ÿßŸÑÿ¥ÿ®ŸÉÿ© ÿßŸÑŸÖÿ≥ÿ™ŸÖÿ±ÿ© + ŸÅÿ≠Ÿàÿµÿßÿ™ Cloudflare (ŸÉŸÑŸáÿß ŸÖŸÜ ÿßŸÑÿÆŸÑŸÅŸäÿ©!)
// @description:bg      *–ë–ï–ó–û–ü–ê–°–ù–û* –ø–æ–¥–¥—ä—Ä–∂–∞ —Å–µ—Å–∏–∏—Ç–µ –Ω–∞ ChatGPT —Å–≤–µ–∂–∏, –µ–ª–∏–º–∏–Ω–∏—Ä–∞–π–∫–∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–∏ –º—Ä–µ–∂–æ–≤–∏ –≥—Ä–µ—à–∫–∏ + –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ Cloudflare (–≤—Å–∏—á–∫–∏ –æ—Ç –∑–∞–¥–µ–Ω –ø–ª–∞–Ω!)
// @description:bn      *‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶¶‡ßá* ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü‡¶ú‡¶ø‡¶™‡¶ø‡¶ü‡¶ø ‡¶∏‡ßá‡¶∂‡¶®‡¶ó‡ßÅ‡¶≤‡¶ø‡¶ï‡ßá ‡¶∏‡¶§‡ßá‡¶ú ‡¶∞‡¶æ‡¶ñ‡ßá, ‡¶ß‡ßç‡¶∞‡ßÅ‡¶¨‡¶ï ‡¶®‡ßá‡¶ü‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶ï ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø‡¶ó‡ßÅ‡¶≤‡¶ø ‡¶¶‡ßÇ‡¶∞ ‡¶ï‡¶∞‡ßá + ‡¶ï‡ßç‡¶≤‡¶æ‡¶â‡¶°‡¶´‡ßç‡¶≤‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ö‡ßá‡¶ï (‡¶∏‡¶¨‡¶á ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶•‡ßá‡¶ï‡ßá!)
// @description:cs      *BEZPEƒåNƒö* udr≈æuje relace ChatGPT ƒçerstv√©, eliminuje neust√°l√© chyby s√≠tƒõ + kontroly Cloudflare (v≈°e na pozad√≠!)
// @description:da      *SIKKERT* holder ChatGPT-sessioner friske og eliminerer konstante netv√¶rksfejl + Cloudflare-tjek (alt sammen fra baggrunden!)
// @description:de      *SICHER* h√§lt ChatGPT-Sitzungen frisch, eliminiert st√§ndige Netzwerkfehler + Cloudflare-Pr√ºfungen (alles aus dem Hintergrund!)
// @description:el      Œ§Œø *SAFELY* Œ¥ŒπŒ±œÑŒ∑œÅŒµŒØ œÜœÅŒ≠œÉŒ∫ŒµœÇ œÑŒπœÇ œÄŒµœÅŒπœåŒ¥ŒøœÖœÇ œÉœçŒΩŒ¥ŒµœÉŒ∑œÇ ChatGPT, ŒµŒæŒ±ŒªŒµŒØœÜŒøŒΩœÑŒ±œÇ œÑŒ± œÉœÖŒΩŒµœáŒÆ œÉœÜŒ¨ŒªŒºŒ±œÑŒ± Œ¥ŒπŒ∫œÑœçŒøœÖ + œÑŒøœÖœÇ ŒµŒªŒ≠Œ≥œáŒøœÖœÇ Cloudflare (œåŒªŒ± Œ±œÄœå œÑŒø œÄŒ±œÅŒ±œÉŒ∫ŒÆŒΩŒπŒø!)
// @description:eo      *SEKURE* konservas ChatGPT-sesiojn fre≈ùaj, forigante konstantajn retajn erarojn + Cloudflare-kontroloj (ƒâiuj el la fono!)
// @description:es      *SEGURIDAD* mantiene las sesiones de ChatGPT actualizadas, lo que elimina los errores de red constantes + las comprobaciones de Cloudflare (¬°todo en segundo plano!)
// @description:fi      *TURVALLISESTI* pit√§√§ ChatGPT-istunnot tuoreina, eliminoiden jatkuvat verkkovirheet + Cloudflare-tarkistukset (kaikki taustalta!)
// @description:fr      *EN TOUTE S√âCURIT√â* maintient les sessions ChatGPT √† jour, √©liminant les erreurs r√©seau constantes + v√©rifications Cloudflare (toutes en arri√®re-plan!)
// @description:fr-CA   *EN TOUTE S√âCURIT√â* maintient les sessions ChatGPT √† jour, √©liminant les erreurs r√©seau constantes + v√©rifications Cloudflare (toutes en arri√®re-plan!)
// @description:gu      *‡™∏‡´á‡™´‡™≤‡´Ä* ‡™ö‡´á‡™ü‡™ú‡´Ä‡™™‡´Ä‡™ü‡´Ä ‡™∏‡™§‡´ç‡™∞‡´ã‡™®‡´á ‡™§‡™æ‡™ú‡™æ ‡™∞‡™æ‡™ñ‡´á ‡™õ‡´á, ‡™∏‡™§‡™§ ‡™®‡´á‡™ü‡™µ‡™∞‡´ç‡™ï ‡™≠‡´Ç‡™≤‡´ã‡™®‡´á ‡™¶‡´Ç‡™∞ ‡™ï‡™∞‡´á ‡™õ‡´á + ‡™ï‡´ç‡™≤‡™æ‡™â‡™°‡™´‡´ç‡™≤‡´á‡™∞ ‡™§‡™™‡™æ‡™∏‡´ã (‡™¨‡™ß‡´Å‡™Ç ‡™™‡´É‡™∑‡´ç‡™†‡™≠‡´Ç‡™Æ‡™ø‡™Æ‡™æ‡™Ç‡™•‡´Ä!)
// @description:hi      ‡§®*‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§* ‡§ö‡•à‡§ü‡§ú‡•Ä‡§™‡•Ä‡§ü‡•Ä ‡§∏‡§§‡•ç‡§∞‡•ã‡§Ç ‡§ï‡•ã ‡§§‡§æ‡§ú‡§º‡§æ ‡§∞‡§ñ‡§§‡§æ ‡§π‡•à, ‡§®‡§ø‡§∞‡§Ç‡§§‡§∞ ‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•ã ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à + ‡§ï‡•ç‡§≤‡§æ‡§â‡§°‡§´‡•ç‡§≤‡•á‡§Ø‡§∞ ‡§ö‡•á‡§ï (‡§∏‡§≠‡•Ä ‡§™‡•É‡§∑‡•ç‡§†‡§≠‡•Ç‡§Æ‡§ø ‡§∏‡•á!)
// @description:hu      *BIZTONS√ÅGOSAN* frissen tartja a ChatGPT munkameneteket, kik√ºsz√∂b√∂lve az √°lland√≥ h√°l√≥zati hib√°kat + Cloudflare ellen≈ërz√©seket (mind a h√°tt√©rb≈ël!)
// @description:in      *AMAN* membuat sesi ChatGPT tetap segar, menghilangkan kesalahan jaringan konstan + pemeriksaan Cloudflare (semua dari latar belakang!)
// @description:it      *IN MODO SICURO* mantiene aggiornate le sessioni di ChatGPT, eliminando i continui errori di rete + i controlli di Cloudflare (tutto in background!)
// @description:iw      *◊ë◊ò◊ï◊ó* ◊©◊ï◊û◊® ◊¢◊ú ◊û◊§◊í◊©◊ô ChatGPT ◊ò◊®◊ô◊ô◊ù, ◊û◊ë◊ò◊ú ◊©◊í◊ô◊ê◊ï◊™ ◊®◊©◊™ ◊ß◊ë◊ï◊¢◊ï◊™ + ◊ë◊ì◊ô◊ß◊ï◊™ Cloudflare (◊î◊õ◊ú ◊û◊î◊®◊ß◊¢!)
// @description:ja      *ÂÆâÂÖ®„Å´* ChatGPT „Çª„ÉÉ„Ç∑„Éß„É≥„ÇíÊúÄÊñ∞„ÅÆÁä∂ÊÖã„Å´‰øù„Å°„ÄÅ‰∏ÄÂÆö„ÅÆ„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ „Ç®„É©„Éº + Cloudflare „ÉÅ„Çß„ÉÉ„ÇØ („Åô„Åπ„Å¶„Éê„ÉÉ„ÇØ„Ç∞„É©„Ç¶„É≥„Éâ„Åã„Çâ!) „ÇíÊéíÈô§„Åó„Åæ„Åô„ÄÇ
// @description:ka      *SAFELY* ·Éò·Éú·Éê·ÉÆ·Éê·Éï·É° ChatGPT ·É°·Éî·É°·Éò·Éî·Éë·É° ·Éê·ÉÆ·Éê·Éö·Éò, ·Éê·É¶·Éõ·Éù·É§·ÉÆ·Éï·É†·Éò·É° ·É•·É°·Éî·Éö·Éò·É° ·Éõ·É£·Éì·Éõ·Éò·Éï ·É®·Éî·É™·Éì·Éù·Éõ·Éî·Éë·É° + Cloudflare ·É®·Éî·Éõ·Éù·É¨·Éõ·Éî·Éë·Éî·Éë·É° (·Éß·Éï·Éî·Éö·Éê·É§·Éî·É†·Éò ·É§·Éù·Éú·Éò·Éì·Éê·Éú!)
// @description:kn      *‡≤∏‡≥Å‡≤∞‡≤ï‡≥ç‡≤∑‡≤ø‡≤§‡≤µ‡≤æ‡≤ó‡≤ø* ‡≤ö‡≤æ‡≤ü‡≥ç‚Äå‡≤ú‡≤ø‡≤™‡≤ø‡≤ü‡≤ø ‡≤∏‡≥Ü‡≤∑‡≤®‡≥ç‚Äå‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤§‡≤æ‡≤ú‡≤æ‡≤µ‡≤æ‡≤ó‡≤ø‡≤∞‡≤ø‡≤∏‡≥Å‡≤§‡≥ç‡≤§‡≤¶‡≥Ü, ‡≤®‡≤ø‡≤∞‡≤Ç‡≤§‡≤∞ ‡≤®‡≥Ü‡≤ü‡≥ç‚Äå‡≤µ‡≤∞‡≥ç‡≤ï‡≥ç ‡≤¶‡≥ã‡≤∑‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤®‡≤ø‡≤µ‡≤æ‡≤∞‡≤ø‡≤∏‡≥Å‡≤§‡≥ç‡≤§‡≤¶‡≥Ü + ‡≤ï‡≥ç‡≤≤‡≥å‡≤°‡≥ç‚Äå‡≤´‡≥ç‡≤≤‡≥á‡≤∞‡≥ç ‡≤™‡≤∞‡≤ø‡≤∂‡≥Ä‡≤≤‡≤®‡≥Ü‡≤ó‡≤≥‡≥Å (‡≤é‡≤≤‡≥ç‡≤≤‡≤µ‡≥Ç ‡≤π‡≤ø‡≤®‡≥ç‡≤®‡≥Ü‡≤≤‡≥Ü‡≤Ø‡≤ø‡≤Ç‡≤¶!)
// @description:ko      *SAFELY*Îäî ChatGPT ÏÑ∏ÏÖòÏùÑ ÏµúÏã† ÏÉÅÌÉúÎ°ú Ïú†ÏßÄÌïòÏó¨ ÏßÄÏÜçÏ†ÅÏù∏ ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•ò + Cloudflare Í≤ÄÏÇ¨(Î™®Îëê Î∞±Í∑∏ÎùºÏö¥ÎìúÏóêÏÑú!)Î•º Ï†úÍ±∞Ìï©ÎãàÎã§.
// @description:ku      *EWLE* dani≈ü√Æn√™n ChatGPT n√ª digire, xeletiy√™n tor√™ y√™n domdar ji hol√™ radike + kontrol√™n Cloudflare (hem√ª ji pa≈ü√Æn!)
// @description:ml      *‡¥∏‡µÅ‡¥∞‡¥ï‡µç‡¥∑‡¥ø‡¥§‡¥Æ‡¥æ‡¥Ø‡¥ø* ChatGPT ‡¥∏‡µÜ‡¥∑‡¥®‡µÅ‡¥ï‡µæ ‡¥™‡µÅ‡¥§‡µÅ‡¥Æ‡¥Ø‡µÅ‡¥≥‡µç‡¥≥‡¥§‡¥æ‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ, ‡¥®‡¥ø‡¥∞‡¥®‡µç‡¥§‡¥∞‡¥Æ‡¥æ‡¥Ø ‡¥®‡µÜ‡¥±‡µç‡¥±‡µç‚Äå‡¥µ‡µº‡¥ï‡µç‡¥ï‡µç ‡¥™‡¥ø‡¥∂‡¥ï‡µÅ‡¥ï‡µæ ‡¥á‡¥≤‡µç‡¥≤‡¥æ‡¥§‡¥æ‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ + ‡¥ï‡µç‡¥≤‡µó‡¥°‡µç‡¥´‡µç‡¥≤‡µÜ‡¥Ø‡µº ‡¥™‡¥∞‡¥ø‡¥∂‡µã‡¥ß‡¥®‡¥ï‡µæ (‡¥é‡¥≤‡µç‡¥≤‡¥æ‡¥Ç ‡¥™‡¥∂‡µç‡¥ö‡¥æ‡¥§‡µç‡¥§‡¥≤‡¥§‡µç‡¥§‡¥ø‡µΩ ‡¥®‡¥ø‡¥®‡µç‡¥®‡µç!)
// @description:mr      *‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§‡§™‡§£‡•á* ChatGPT ‡§∏‡§§‡•ç‡§∞‡•á ‡§§‡§æ‡§ú‡•á ‡§†‡•á‡§µ‡§§‡•á, ‡§∏‡§§‡§§ ‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§§‡•ç‡§∞‡•Å‡§ü‡•Ä ‡§¶‡•Ç‡§∞ ‡§ï‡§∞‡§§‡•á + ‡§ï‡•ç‡§≤‡§æ‡§â‡§°‡§´‡•ç‡§≤‡•á‡§Ö‡§∞ ‡§§‡§™‡§æ‡§∏‡§£‡•Ä (‡§∏‡§∞‡•ç‡§µ ‡§™‡§æ‡§∞‡•ç‡§∂‡•ç‡§µ‡§≠‡•Ç‡§Æ‡•Ä‡§§‡•Ç‡§®!)
// @description:ms      *SELAMAT* memastikan sesi ChatGPT sentiasa segar, menghapuskan ralat rangkaian berterusan + pemeriksaan Cloudflare (semua dari latar belakang!)
// @description:my      *·Äò·Ä±·Ä∏·ÄÄ·ÄÑ·Ä∫·Ä∏·ÄÖ·ÄΩ·Ä¨* ·Äû·Ää·Ä∫ ChatGPT ·ÄÜ·ÄÄ·Ä∫·Äõ·Äæ·ÄÑ·Ä∫·Äô·Äª·Ä¨·Ä∏·ÄÄ·Ä≠·ÄØ ·Äú·Äê·Ä∫·ÄÜ·Äê·Ä∫·Äî·Ä±·ÄÖ·Ä±·Äï·Äº·ÄÆ·Ä∏ ·Ä°·Äô·Äº·Ä≤·Äô·Äï·Äº·Äê·Ä∫ ·ÄÄ·ÄΩ·Äî·Ä∫·Äõ·ÄÄ·Ä∫·Ä°·Äô·Äæ·Ä¨·Ä∏·Ä°·Äö·ÄΩ·ÄÑ·Ä∫·Ä∏·Äô·Äª·Ä¨·Ä∏·ÄÄ·Ä≠·ÄØ ·Äñ·Äö·Ä∫·Äõ·Äæ·Ä¨·Ä∏·Äï·Ä±·Ä∏·Äû·Ää·Ä∫ + Cloudflare ·ÄÖ·ÄÖ·Ä∫·ÄÜ·Ä±·Ä∏·Äô·Äæ·ÄØ·Äô·Äª·Ä¨·Ä∏ (·Ä°·Ä¨·Ä∏·Äú·ÄØ·Ä∂·Ä∏·Äû·Ää·Ä∫ ·Äî·Ä±·Ä¨·ÄÄ·Ä∫·ÄÅ·Ä∂·Äô·Äæ!)
// @description:nl      *VEILIG* houdt ChatGPT-sessies up-to-date en elimineert constante netwerkfouten + Cloudflare-controles (allemaal vanaf de achtergrond!)
// @description:no      *SIKKERT* holder ChatGPT-√∏kter ferske, og eliminerer konstante nettverksfeil + Cloudflare-sjekker (alt fra bakgrunnen!)
// @description:or      *‡¨®‡¨ø‡¨∞‡¨æ‡¨™‡¨¶* ‡¨ö‡¨æ‡¨ü‡≠ç ‡¨ú‡¨ø‡¨™‡¨ø‡¨ü‡¨ø ‡¨Ö‡¨ß‡¨ø‡¨¨‡≠á‡¨∂‡¨®‡¨ï‡≠Å ‡¨∏‡¨§‡≠á‡¨ú ‡¨∞‡¨ñ‡≠á, ‡¨ï‡≠ç‡¨∞‡¨Æ‡¨æ‡¨ó‡¨§ ‡¨®‡≠á‡¨ü‡≠±‡¨æ‡¨∞‡≠ç‡¨ï ‡¨§‡≠ç‡¨∞‡≠Å‡¨ü‡¨ø + ‡¨ï‡≠ç‡¨≤‡¨æ‡¨â‡¨°‡≠ç ‡¨´‡≠ç‡¨≤‡¨æ‡¨∞‡≠ç ‡¨ö‡≠á‡¨ï‡≠ç (‡¨∏‡¨Æ‡¨∏‡≠ç‡¨§ ‡¨™‡≠É‡¨∑‡≠ç‡¨†‡¨≠‡≠Ç‡¨Æ‡¨ø‡¨∞‡≠Å!)
// @description:pa      *‡®∏‡©Å‡®∞‡©±‡®ñ‡®ø‡®Ö‡®§* ‡®ö‡©à‡®ü‡®ú‡©Ä‡®™‡©Ä‡®ü‡©Ä ‡®∏‡©à‡®∏‡®º‡®®‡®æ‡®Ç ‡®®‡©Ç‡©∞ ‡®§‡®æ‡®ú‡®º‡®æ ‡®∞‡©±‡®ñ‡®¶‡®æ ‡®π‡©à, ‡®®‡®ø‡®∞‡©∞‡®§‡®∞ ‡®®‡©à‡©±‡®ü‡®µ‡®∞‡®ï ‡®§‡®∞‡©Å‡®ü‡©Ä‡®Ü‡®Ç ‡®®‡©Ç‡©∞ ‡®ñ‡®§‡®Æ ‡®ï‡®∞‡®¶‡®æ ‡®π‡©à + ‡®ï‡®≤‡®æ‡®â‡®°‡®´‡®≤‡©á‡®Ö‡®∞ ‡®ú‡®æ‡®Ç‡®ö‡®æ‡®Ç (‡®∏‡®æ‡®∞‡©á ‡®™‡®ø‡®õ‡©ã‡®ï‡©ú ‡®§‡©ã‡®Ç!)
// @description:pl      *BEZPIECZNIE* utrzymuje aktualne sesje ChatGPT, eliminujƒÖc ciƒÖg≈Çe b≈Çƒôdy sieciowe + kontrole Cloudflare (wszystko w tle!)
// @description:pt      *SEGURAN√áA* mant√©m as sess√µes ChatGPT atualizadas, eliminando erros constantes de rede + verifica√ß√µes Cloudflare (tudo em segundo plano!)
// @description:pt-BR   *SEGURAN√áA* mant√©m as sess√µes ChatGPT atualizadas, eliminando erros constantes de rede + verifica√ß√µes Cloudflare (tudo em segundo plano!)
// @description:ro      *√éN SIGURAN»öƒÇ* pƒÉstreazƒÉ sesiunile ChatGPT actuale, elimin√¢nd erorile constante de re»õea + verificƒÉri Cloudflare (toate din fundal!)
// @description:ru      *–ë–ï–ó–û–ü–ê–°–ù–û* –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–µ–∞–Ω—Å—ã ChatGPT, —É—Å—Ç—Ä–∞–Ω—è—è –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ —Å–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏ + –ø—Ä–æ–≤–µ—Ä–∫–∏ Cloudflare (–≤—Å–µ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ!)
// @description:sk      *BEZPEƒåNE* udr≈æiava rel√°cie ChatGPT ƒçerstv√©, ƒç√≠m sa eliminuj√∫ neust√°le chyby siete + kontroly Cloudflare (v≈°etko na pozad√≠!)
// @description:sr      *–°–ò–ì–£–†–ù–û* –æ–¥—Ä–∂–∞–≤–∞ —Å–µ—Å–∏—ò–µ –¶—Ö–∞—Ç–ì–ü–¢ —Å–≤–µ–∂–∏–º, –µ–ª–∏–º–∏–Ω–∏—à—É—õ–∏ —Å—Ç–∞–ª–Ω–µ –º—Ä–µ–∂–Ω–µ –≥—Ä–µ—à–∫–µ + –¶–ª–æ—É–¥—Ñ–ª–∞—Ä–µ –ø—Ä–æ–≤–µ—Ä–µ (—Å–≤–µ –∏–∑ –ø–æ–∑–∞–¥–∏–Ω–µ!)
// @description:sv      *S√ÑKERT* h√•ller ChatGPT-sessioner fr√§scha och eliminerar konstant n√§tverksfel + Cloudflare-kontroller (alla fr√•n bakgrunden!)
// @description:ta      *‡Æ™‡Ææ‡Æ§‡ØÅ‡Æï‡Ææ‡Æ™‡Øç‡Æ™‡Ææ‡Æï* ChatGPT ‡ÆÖ‡ÆÆ‡Æ∞‡Øç‡Æµ‡ØÅ‡Æï‡Æ≥‡Øà ‡Æ™‡ØÅ‡Æ§‡Æø‡ÆØ‡Æ§‡Ææ‡Æï ‡Æµ‡Øà‡Æ§‡Øç‡Æ§‡Æø‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡Æø‡Æ±‡Æ§‡ØÅ, ‡Æ®‡Æø‡Æ≤‡Øà‡ÆØ‡Ææ‡Æ© ‡Æ®‡ØÜ‡Æü‡Øç‡Æµ‡Øä‡Æ∞‡Øç‡Æï‡Øç ‡Æ™‡Æø‡Æ¥‡Øà‡Æï‡Æ≥‡Øç + Cloudflare ‡Æö‡Øã‡Æ§‡Æ©‡Øà‡Æï‡Æ≥‡Øà ‡Æ®‡ØÄ‡Æï‡Øç‡Æï‡ØÅ‡Æï‡Æø‡Æ±‡Æ§‡ØÅ (‡ÆÖ‡Æ©‡Øà‡Æ§‡Øç‡Æ§‡ØÅ‡ÆÆ‡Øç ‡Æ™‡Æø‡Æ©‡Øç‡Æ™‡ØÅ‡Æ≤‡Æ§‡Øç‡Æ§‡Æø‡Æ≤‡Æø‡Æ∞‡ØÅ‡Æ®‡Øç‡Æ§‡ØÅ!)
// @description:th      *‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢* ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÄ‡∏ã‡∏™‡∏ä‡∏±‡∏ô ChatGPT ‡πÉ‡∏´‡πâ‡∏™‡∏î‡πÉ‡∏´‡∏°‡πà ‡∏Å‡∏≥‡∏à‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á + ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Cloudflare (‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á!)
// @description:tr      *G√úVENLƒ∞* ChatGPT oturumlarƒ±nƒ± g√ºncel tutar, s√ºrekli aƒü hatalarƒ±nƒ± ve Cloudflare kontrollerini (hepsi arka planda!) ortadan kaldƒ±rƒ±r.
// @description:uk      *–ë–ï–ó–ü–ï–ß–ù–û* –ø—ñ–¥—Ç—Ä–∏–º—É—î —Å–µ–∞–Ω—Å–∏ ChatGPT —Å–≤—ñ–∂–∏–º–∏, —É—Å—É–≤–∞—é—á–∏ –ø–æ—Å—Ç—ñ–π–Ω—ñ –ø–æ–º–∏–ª–∫–∏ –º–µ—Ä–µ–∂—ñ + –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ Cloudflare (–≤—Å–µ —É —Ñ–æ–Ω–æ–≤–æ–º—É —Ä–µ–∂–∏–º—ñ!)
// @description:ur      *ŸÖÿ≠ŸÅŸàÿ∏ ÿ∑ÿ±€åŸÇ€í ÿ≥€í* ⁄Ü€åŸπ ÿ¨€å Ÿæ€å Ÿπ€å ÿ≥€åÿ¥ŸÜÿ≤ ⁄©Ÿà ÿ™ÿßÿ≤€Å ÿ±⁄©⁄æÿ™ÿß €Å€íÿå ŸÜ€åŸπ Ÿàÿ±⁄© ⁄©€å ŸÖÿ≥ÿ™ŸÇŸÑ ÿÆÿ±ÿßÿ®€åŸà⁄∫ ⁄©Ÿà ÿÆÿ™ŸÖ ⁄©ÿ±ÿ™ÿß €Å€í + ⁄©ŸÑÿßÿ§⁄à ŸÅŸÑ€åÿ¶ÿ± ⁄Ü€å⁄©ÿ≥ (ÿ≥ÿ® ⁄©⁄Ü⁄æ Ÿæÿ≥ ŸÖŸÜÿ∏ÿ± ÿ≥€í!)
// @description:vi      *AN TO√ÄN* gi·ªØ cho c√°c phi√™n ChatGPT lu√¥n m·ªõi, lo·∫°i b·ªè c√°c l·ªói m·∫°ng li√™n t·ª•c + ki·ªÉm tra Cloudflare (t·∫•t c·∫£ t·ª´ n·ªÅn!)
// @description:zh-CN   *ÂÆâÂÖ®*‰øùÊåÅ ChatGPT ‰ºöËØùÊñ∞È≤úÔºåÊ∂àÈô§ÊåÅÁª≠ÁöÑÁΩëÁªúÈîôËØØ + Cloudflare Ê£ÄÊü•ÔºàÂÖ®ÈÉ®Êù•Ëá™ÂêéÂè∞ÔºÅÔºâ
// @description:zh-HK   *ÂÆâÂÖ®*‰øùÊåÅ ChatGPT ÊúÉË©±Êñ∞ÈÆÆÔºåÊ∂àÈô§ÊåÅÁ∫åÁöÑÁ∂≤Áµ°ÈåØË™§ + Cloudflare Ê™¢Êü•ÔºàÂÖ®ÈÉ®‰æÜËá™ÂæåÂè∞ÔºÅÔºâ
// @description:zh-SG   *ÂÆâÂÖ®*‰øùÊåÅ ChatGPT ‰ºöËØùÊñ∞È≤úÔºåÊ∂àÈô§ÊåÅÁª≠ÁöÑÁΩëÁªúÈîôËØØ + Cloudflare Ê£ÄÊü•ÔºàÂÖ®ÈÉ®Êù•Ëá™ÂêéÂè∞ÔºÅÔºâ
// @description:zh-TW   *ÂÆâÂÖ®*‰øùÊåÅ ChatGPT ÊúÉË©±Êñ∞ÈÆÆÔºåÊ∂àÈô§ÊåÅÁ∫åÁöÑÁ∂≤Áµ°ÈåØË™§ + Cloudflare Ê™¢Êü•ÔºàÂÖ®ÈÉ®‰æÜËá™ÂæåÂè∞ÔºÅÔºâ
// @license             MIT
// @match               https://chat.openai.com/*
// @compatible          chrome
// @compatible          firefox
// @compatible          edge
// @compatible          opera
// @compatible          brave
// @compatible          vivaldi
// @compatible          waterfox
// @compatible          librewolf
// @compatible          ghost
// @compatible          qq
// @icon                https://raw.githubusercontent.com/adamlui/userscripts/master/chatgpt/media/icons/openai-favicon48.png
// @icon64              https://raw.githubusercontent.com/adamlui/userscripts/master/chatgpt/media/icons/openai-favicon64.png
// @require             https://cdn.jsdelivr.net/gh/chatgptjs/chatgpt.js@f855a11607839fbc55273db604d167b503434598/dist/chatgpt-1.9.1.min.js
// @connect             raw.githubusercontent.com
// @grant               GM_setValue
// @grant               GM_getValue
// @grant               GM_registerMenuCommand
// @grant               GM_unregisterMenuCommand
// @grant               GM.xmlHttpRequest
// @noframes
// @homepageURL         https://github.com/adamlui/chatgpt-auto-refresh
// @supportURL          https://github.com/adamlui/chatgpt-auto-refresh/issues
// ==/UserScript==

// NOTE: This script relies on the powerful chatgpt.js library @ https://chatgpt.js.org (c) 2023 KudoAI & contributors under the MIT license.

(async () => {

    // Initialize settings
    var appSymbol = '‚Üª', configPrefix = 'chatGPTar_'
    var config = { userLanguage: navigator.languages[0] || navigator.language || '' }
    loadSetting('arDisabled', 'lastCheckTime', 'notifHidden', 'refreshInterval', 'skipNextUpdate', 'skippedVer', 'toggleHidden')
    if (!config.refreshInterval) saveSetting('refreshInterval', 30) // init refresh interval to 30 secs if unset

    // Define messages
    var msgsLoaded = new Promise(resolve => {
        var msgHostDir = 'https://raw.githubusercontent.com/adamlui/chatgpt-auto-refresh/main/greasemonkey/_locales/'
        var msgLocaleDir = ( config.userLanguage ? config.userLanguage.replace('-', '_') : 'en' ) + '/'
        var msgHref = msgHostDir + msgLocaleDir + 'messages.json' // build src link
        var msgXHRtries = 0
        GM.xmlHttpRequest({ method: 'GET', url: msgHref, onload: onLoad })
        function onLoad(response) {
            try { // to return localized messages.json
                var messages = new Proxy(JSON.parse(response.responseText), {
                    get(target, prop) { // remove need to ref nested keys
                        if (typeof target[prop] === 'object' && target[prop] !== null && 'message' in target[prop]) {
                            return target[prop].message
                }}}) ; resolve(messages)
            } catch (error) { // if 404
                msgXHRtries++ ; if (msgXHRtries == 3) return // try up to 3X (original/region-stripped/EN) only
                msgHref = config.userLanguage.includes('-') && msgXHRtries == 1 ? // if regional lang on 1st try...
                    msgHref.replace(/(.*)_.*(\/.*)/, '$1$2') // ...strip region before retrying
                        : ( msgHostDir + 'en/messages.json' ) // else use default English messages
                GM.xmlHttpRequest({ method: 'GET', url: msgHref, onload: onLoad })
            }
        }
    }) ; var messages = await msgsLoaded

    // Init/register menu
    await chatgpt.isLoaded()
    var menuIDs = [], stateSymbol = ['‚úîÔ∏è', '‚ùå'], stateWord = ['ON', 'OFF'] // initialize menu vars
    registerMenu() // create browser toolbar menu

    // Check for updates (1x/48h)
    if (!config.lastCheckTime || Date.now() - config.lastCheckTime > 172800000) checkForUpdates()

    // Stylize toggle switch
    var switchStyle = document.createElement('style')
    switchStyle.innerHTML = `/* Stylize switch */
        .switch { position:absolute ; left:208px ; width:34px ; height:18px }
        .switch input { opacity:0 ; width:0 ; height:0 } /* hide checkbox */
        .slider { position:absolute ; cursor:pointer ; top:0 ; left:0 ; right:0 ; bottom:0 ; background-color:#ccc ; -webkit-transition:.4s ; transition:.4s ; border-radius:28px }
        .slider:before { position:absolute ; content:"" ; height:14px ; width:14px ; left:3px; bottom:2px ; background-color:white ; -webkit-transition:.4s ; transition:.4s ; border-radius:28px }

        /* Position/color ON-state */
        input:checked { position:absolute ; right:3px }
        input:checked + .slider { background-color:#42B4BF }
        input:checked + .slider:before {
            -webkit-transform: translateX(14px) translateY(1px) ;
            -ms-transform: translateX(14px) translateY(1px) ;
            transform: translateX(14px) }`

    document.head.appendChild(switchStyle)

    // Create toggle label, add listener/max-height/classes/HTML
    var toggleLabel = document.createElement('div') // create label div
    toggleLabel.addEventListener('click', function() {
        var toggleInput = document.querySelector('#autoRefreshToggle')
        toggleInput.click()
        setTimeout(updateToggleHTML, 200) // sync label change w/ switch movement
        config.arDisabled = !toggleInput.checked
        for (var id of menuIDs) GM_unregisterMenuCommand(id) ; registerMenu() // refresh menu
        if (!config.arDisabled && !chatgpt.autoRefresh.isActive) {
            chatgpt.autoRefresh.activate(config.refreshInterval) // ; config.isActive = true
            if (!config.notifHidden) {
                chatgpt.notify(appSymbol + ' ' + messages.menuLabel_autoRefresh + ': ON',
                    '', '', chatgpt.isDarkMode() ? '' : 'shadow')
        }} else if (config.arDisabled && chatgpt.autoRefresh.isActive) {
            chatgpt.autoRefresh.deactivate() // ; config.isActive = false
            if (!config.notifHidden) {
                chatgpt.notify(appSymbol + ' ' + messages.menuLabel_autoRefresh + ': OFF',
                    '', '', chatgpt.isDarkMode() ? '' : 'shadow')
        }} saveSetting('arDisabled', config.arDisabled)
    })
    for (var navLink of document.querySelectorAll('nav[aria-label="Chat history"] a')) { // inspect sidebar for classes to borrow
        if (navLink.text.match(/(new|clear) chat/i)) { // focus on new/clear chat button
            toggleLabel.setAttribute('class', navLink.classList) // borrow link classes
            navLink.parentNode.style.margin = '2px 0' // add v-margins
            break // stop looping since class assignment is done
    }}
    toggleLabel.style.maxHeight = '44px' // prevent flex overgrowth
    toggleLabel.style.margin = '2px 0' // add v-margins
    updateToggleHTML()

    // Insert full toggle on page load + during navigation // Âú®ÂØºËà™ÊúüÈó¥ÊèíÂÖ•È°µÈù¢Âä†ËΩΩ + ÁöÑÂÆåÊï¥ÂàáÊç¢
    insertToggle()
    var navObserver = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            if (mutation.type === 'childList' && mutation.addedNodes.length) {
                insertToggle()
    }})}) ; navObserver.observe(document.documentElement, { childList: true, subtree: true })

    // Activate auto-refresh on first visit if enabled
    if (!config.arDisabled) {
        chatgpt.autoRefresh.activate(config.refreshInterval) // ; config.isActive = true
        if (!config.notifHidden) {
            chatgpt.notify(appSymbol + ' ' + messages.menuLabel_autoRefresh + ': ON',
                '', '', chatgpt.isDarkMode() ? '' : 'shadow')
    }}

    // Define SCRIPT functions

    function registerMenu() {
        menuIDs = [] // empty to store newly registered cmds for removal while preserving order
        var stateSeparator = getUserscriptManager() === 'Tampermonkey' ? ' ‚Äî ' : ': '

        // Add command to toggle auto-refresh
        var arLabel = stateSymbol[+config.arDisabled] + ' ' + messages.menuLabel_autoRefresh + ' ‚Üª '
                    + stateSeparator + stateWord[+config.arDisabled]
        menuIDs.push(GM_registerMenuCommand(arLabel, function() {
            document.querySelector('#autoRefreshToggle').click()
        }))

        // Add command to toggle visibility of toggle
        var tvLabel = stateSymbol[+config.toggleHidden] + ' ' + messages.menuLabel_toggleVis
            + stateSeparator + stateWord[+config.toggleHidden]
        menuIDs.push(GM_registerMenuCommand(tvLabel, function() {
            saveSetting('toggleHidden', !config.toggleHidden)
            toggleLabel.style.display = config.toggleHidden ? 'none' : 'flex' // toggle visibility
            if (!config.notifHidden) {
                chatgpt.notify(appSymbol + ' ' + messages.menuLabel_toggleVis + ': '+ stateWord[+config.toggleHidden],
                    '', '', chatgpt.isDarkMode() ? '' : 'shadow')
            } for (var id of menuIDs) GM_unregisterMenuCommand(id) ; registerMenu() // refresh menu
        }))

        // Add command to show notifications when switching modes
        var mnLabel = stateSymbol[+config.notifHidden] + ' ' + messages.menuLabel_modeNotifs
                    + stateSeparator + stateWord[+config.notifHidden]
        menuIDs.push(GM_registerMenuCommand(mnLabel, function() {
            saveSetting('notifHidden', !config.notifHidden)
            chatgpt.notify(appSymbol + ' ' + messages.menuLabel_modeNotifs + ': ' + stateWord[+config.notifHidden],
                '', '', chatgpt.isDarkMode() ? '' : 'shadow')
            for (var i = 0 ; i < menuIDs.length ; i++) GM_unregisterMenuCommand(menuIDs[i]) // remove all cmd's
            registerMenu() // serve fresh one
        }))

        // Add command to change refresh interval
        var riLabel = '‚åö ' + messages.menuLabel_refreshInt + ' ' + stateSeparator + config.refreshInterval + 's'
        menuIDs.push(GM_registerMenuCommand(riLabel, function() {
            while (true) {
                var refreshInterval = prompt(`${ messages.prompt_updateInt }:`, config.refreshInterval)
                if (refreshInterval === null) break // user cancelled so do nothing
                else if (!isNaN(parseInt(refreshInterval)) && parseInt(refreshInterval) > 0) { // valid int set
                    saveSetting('refreshInterval', parseInt(refreshInterval))
                    if (chatgpt.autoRefresh.isActive) { // reset running auto-refresh
                        chatgpt.autoRefresh.deactivate()
                        chatgpt.autoRefresh.activate(refreshInterval)
                    }
                    for (var i = 0 ; i < menuIDs.length ; i++) GM_unregisterMenuCommand(menuIDs[i]) // remove all cmd's
                    registerMenu() // serve fresh one
                    var minInterval = Math.max(2, config.refreshInterval - 10)
                    var maxInterval = config.refreshInterval + 10
                    alert(`${ messages.alert_intUpdated } ${ minInterval }‚Äì${ maxInterval } secs`)
                    break
        }}}))

        // Add command to check for updates
        var ucLabel = 'üöÄ Check for Updates'
        menuIDs.push(GM_registerMenuCommand(ucLabel, function() { checkForUpdates.fromMenu = true ; checkForUpdates() }))
    }

    function getUserscriptManager() {
        try { return GM_info.scriptHandler } catch (error) { return 'other' }}

    function loadSetting(...keys) {
        keys.forEach(key => {
            config[key] = GM_getValue(configPrefix + key, false)
    })}

    function saveSetting(key, value) {
        GM_setValue(configPrefix + key, value) // save to browser
        config[key] = value // and memory
    }

    function checkForUpdates() {

        // Fetch latest meta
        var updateURL = GM_info.scriptUpdateURL || GM_info.script.updateURL || GM_info.script.downloadURL
        var currentVer = GM_info.script.version
        fetch(updateURL + '?t=' + Date.now(), { cache: 'no-cache' })
            .then((response) => { response.text().then((data) => {
                saveSetting('lastCheckTime', Date.now())

                // Compare versions                
                var latestVer = data.match(/@version +(.*)/)[1]
                if (!checkForUpdates.fromMenu && config.skipNextUpdate && latestVer === config.skippedVer)
                    return // exit comparison if past auto-alert hidden
                for (var i = 0 ; i < 4 ; i++) { // loop thru subver's
                    if (parseInt(latestVer.split('.')[i] || 0) > parseInt(currentVer.split('.')[i] || 0)) { // if outdated

                        // Alert to update
                        chatgpt.alert(`${ appSymbol } Update available! üöÄ`,
                            `An update to ${ messages.appName } (v${ latestVer }) is available!`
                                + `<a target="_blank" href="https://github.com/adamlui/chatgpt-auto-refresh/commits/main/greasemonkey/chatgpt-auto-refresh.user.js" style="font-size: 0.7rem ; position: relative ; left: 8px">View changes</a>`,
                            function update() { // button
                                saveSetting('skipNextUpdate', false) // reset hidden alert setting
                                window.open(( updateURL.includes('.meta.') ? GM_info.script.downloadURL : updateURL )
                                    + '?t=' + Date.now(), '_blank') },
                            !checkForUpdates.fromMenu ? // checkbox if auto-alert
                                function dontShowAgainUntilNextUpdate() {
                                    saveSetting('skipNextUpdate', !config.skipNextUpdate)
                                    saveSetting('skippedVer', config.skipNextUpdate ? latestVer : false) }
                                : ''
                        )
                        return
                }}

                if (checkForUpdates.fromMenu) { // alert to no update found
                    chatgpt.alert(`${ appSymbol } Up-to-date!`, // title
                        `${ messages.appName } (v${ currentVer }) is up-to-date!`) // msg
    }})})}

    // Define TOGGLE functions

    function insertToggle() {
        var chatHistoryNav = document.querySelector('nav[aria-label="Chat history"]') || {}
        var firstButton = chatHistoryNav.querySelector('a') || {}
        if (chatgpt.history.isOff()) try { firstButton.parentNode.nextElementSibling.style.display = 'none' } catch (error) {} // hide enable-history spam div
        if (!chatHistoryNav.contains(toggleLabel)) try { chatHistoryNav.insertBefore(toggleLabel, firstButton.parentNode) } catch (error) {} // insert toggle
    }

    function updateToggleHTML() {
        toggleLabel.innerHTML = (
            '<img width="18px" src="https://raw.githubusercontent.com/adamlui/chatgpt-auto-refresh/main/media/images/icons/auto-refresh-navicon-light-155.png">'
                + ( messages.menuLabel_autoRefresh
                    + (( messages.menuLabel_autoRefresh.length + Math.max(messages.state_disabled.length, messages.state_enabled.length )) > 21 ? ''
                        : ( ' ' + ( config.arDisabled ? messages.state_disabled : messages.state_enabled ))))
                + '<label class="switch" ><input id="autoRefreshToggle" type="checkbox"'
                + ( !config.arDisabled ? 'checked="true"' : '' ) + '><span class="slider"></span></label>' )
        toggleLabel.style.display = config.toggleHidden ? 'none' : 'flex'
    }

})()
