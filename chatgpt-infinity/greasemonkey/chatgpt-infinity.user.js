// ==UserScript==
// @name                ChatGPT Infinity ‚àû
// @name:ar             ChatGPT ÿ•ŸÜŸÅŸäŸÜŸäÿ™Ÿä ‚àû
// @name:bg             ChatGPT –ë–µ–∑–∫—Ä–∞–π–Ω–æ—Å—Ç ‚àû
// @name:bn             ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü‡¶ú‡¶ø‡¶™‡¶ø‡¶ü‡¶ø ‡¶á‡¶®‡¶´‡¶ø‡¶®‡¶ø‡¶ü‡¶ø ‚àû
// @name:cs             ChatGPT Nekoneƒçno ‚àû
// @name:da             ChatGPT Uendelighed ‚àû
// @name:de             ChatGPT Unendlichkeit ‚àû
// @name:el             ChatGPT ŒÜœÄŒµŒπœÅŒø ‚àû
// @name:eo             ChatGPT Senfina ‚àû
// @name:es             ChatGPT Infinito ‚àû
// @name:fi             ChatGPT √Ñ√§rett√∂myys ‚àû
// @name:fr             ChatGPT Infini ‚àû
// @name:fr-CA          ChatGPT Infini ‚àû
// @name:gu             ‡™ö‡´á‡™ü‡™ú‡´Ä‡™™‡´Ä‡™ü‡´Ä ‡™Ö‡™®‡™Ç‡™§ ‚àû
// @name:hi             ‡§ö‡•à‡§ü‡§ú‡•Ä‡§™‡•Ä‡§ü‡•Ä ‡§Ö‡§®‡§Ç‡§§ ‚àû
// @name:hu             ChatGPT V√©gtelen ‚àû
// @name:in             ChatGPT Tak Terhingga ‚àû
// @name:it             ChatGPT Infinito ‚àû
// @name:iw             ◊¶'◊ê◊ò◊í◊§◊ò ◊ê◊ô◊†◊°◊ï◊£ ‚àû
// @name:ja             ChatGPT ÁÑ°ÈôêÂ§ß ‚àû
// @name:ka             ChatGPT ·É£·É°·Éê·É°·Éò ‚àû
// @name:kn             ‡≤ö‡≤æ‡≤ü‡≥ç‡≤ú‡≤ø‡≤™‡≤ø‡≤ü‡≤ø ‡≤Ö‡≤®‡≤Ç‡≤§ ‚àû
// @name:ko             ChatGPT Î¨¥ÌïúÎåÄ ‚àû
// @name:ku             ChatGPT B√™daw√Æ ‚àû
// @name:ml             ‡¥ö‡¥æ‡¥±‡µç‡¥±‡µç‚Äå‡¥ú‡¥ø‡¥™‡¥ø‡¥ü‡¥ø ‡¥Ö‡¥®‡¥®‡µç‡¥§‡¥§‡¥Ø‡µÅ‡¥Ç ‚àû
// @name:mr             ‡§ö‡•Ö‡§ü‡§ú‡•Ä‡§™‡•Ä‡§ü‡•Ä ‡§Ö‡§®‡§Ç‡§§ ‚àû
// @name:ms             ChatGPT Tak Terhingga ‚àû
// @name:my             ChatGPT ·Ä°·Äô·Äª·Ä¨·Ä∏·ÄÄ·Äº·ÄÆ·Ä∏ ‚àû
// @name:nl             ChatGPT Oneindigheid ‚àû
// @name:no             ChatGPT Uendelighet ‚àû
// @name:or             ‡¨ö‡¨æ‡¨ü‡¨ú‡¨ø‡¨™‡¨ø‡¨ü‡¨ø ‡¨Ö‡¨®‡¨®‡≠ç‡¨§ ‚àû
// @name:pa             ‡®ö‡©à‡®ü‡®ú‡©Ä‡®™‡©Ä‡®ü‡©Ä ‡®Ö‡®®‡©∞‡®§ ‚àû
// @name:pl             ChatGPT Niesko≈Ñczono≈õƒá ‚àû
// @name:pt             ChatGPT Infinito ‚àû
// @name:pt-BR          ChatGPT Infinito ‚àû
// @name:ro             ChatGPT Infinit ‚àû
// @name:ru             ChatGPT –ë–µ—Å–∫–æ–Ω–µ—á–Ω–æ—Å—Ç—å ‚àû
// @name:sk             ChatGPT Nekoneƒçno ‚àû
// @name:sr             ChatGPT –ë–µ—Å–∫–æ–Ω–∞—á–Ω–æ—Å—Ç ‚àû
// @name:ta             ‡Æö‡Ææ‡Æü‡Øç ‡Æú‡Æø‡Æ™‡Æø‡Æü‡Æø ‡ÆÆ‡ØÅ‡Æ¥‡ØÅ‡ÆÆ‡Øà‡ÆØ‡Ææ‡Æ© ‚àû
// @name:th             ChatGPT ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î ‚àû
// @name:tr             ChatGPT Sonsuzluk ‚àû
// @name:uk             ChatGPT –ù–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω—ñ—Å—Ç—å ‚àû
// @name:ur             ⁄Ü€åŸπ ÿ¨€å Ÿæ€å Ÿπ€å ÿ®€í ÿßŸÜÿ™€Åÿß ‚àû
// @name:vi             ChatGPT V√¥ H·∫°n ‚àû
// @name:zh-CN          ChatGPT Êó†Èôê ‚àû
// @name:zh-HK          ChatGPT ÁÑ°Èôê ‚àû
// @name:zh-SG          ChatGPT Êó†Èôê ‚àû
// @name:zh-TW          ChatGPT ÁÑ°Èôê ‚àû
// @version             2023.5.17
// @description         Generate endless answers from all-knowing ChatGPT (in any language!)
// @description:ar      ÿßÿ≠ÿµŸÑ ÿπŸÑŸâ ÿ•ÿ¨ÿßÿ®ÿßÿ™ ŸÑÿß ÿ≠ÿµÿ± ŸÑŸáÿß ŸÖŸÜ ChatGPT ÿßŸÑÿ∞Ÿä Ÿäÿπÿ±ŸÅ ÿßŸÑÿ¨ŸÖŸäÿπ (ÿ®ÿ£Ÿä ŸÑÿ∫ÿ©!)
// @description:bg      –ì–µ–Ω–µ—Ä–∏—Ä–∞–π—Ç–µ –±–µ–∑–∫—Ä–∞–π–Ω–∏ –æ—Ç–≥–æ–≤–æ—Ä–∏ –æ—Ç –≤—Å–µ–∑–Ω–∞–µ—â–∏—è ChatGPT (–Ω–∞ –≤—Å–µ–∫–∏ –µ–∑–∏–∫!)
// @description:bn      ‡¶∏‡¶∞‡ßç‡¶¨‡¶ú‡¶®‡¶¨‡¶ø‡¶¶‡¶ø‡¶§ ChatGPT ‡¶•‡ßá‡¶ï‡ßá ‡¶Ö‡¶¨‡¶ø‡¶∞‡¶æ‡¶Æ ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶® (‡¶Ø‡ßá‡¶ï‡ßã‡¶® ‡¶≠‡¶æ‡¶∑‡¶æ‡¶Ø‡¶º!)
// @description:cs      Generujte nekoneƒçn√© odpovƒõdi ze v≈°evƒõdouc√≠ho ChatGPT (v jak√©mkoli jazyce!)
// @description:da      Generer endel√∏se svar fra alvidende ChatGPT (p√• ethvert sprog!)
// @description:de      Generieren Sie endlose Antworten aus dem allwissenden ChatGPT (in jeder Sprache!)
// @description:el      ŒîŒ∑ŒºŒπŒøœÖœÅŒ≥ŒÆœÉœÑŒµ Œ±œÑŒµŒªŒµŒØœâœÑŒµœÇ Œ±œÄŒ±ŒΩœÑŒÆœÉŒµŒπœÇ Œ±œÄœå œÑŒø œÄŒ±ŒΩœÑŒøŒ≥ŒΩœéœÉœÑŒ∑ ChatGPT (œÉŒµ ŒøœÄŒøŒπŒ±Œ¥ŒÆœÄŒøœÑŒµ Œ≥ŒªœéœÉœÉŒ±!)
// @description:eo      Generu senfinajn respondojn de ƒâioscia ChatGPT (en iu ajn lingvo!)
// @description:es      Genera infinitas respuestas desde ChatGPT que todo lo sabe (¬°en cualquier idioma!)
// @description:fi      Luo loputtomasti vastauksia kaikkitiet√§v√§st√§ ChatGPT:st√§ (mill√§ tahansa kielell√§!)
// @description:fr      G√©n√©rez des r√©ponses sans fin √† partir de ChatGPT qui sait tout (dans n'importe quelle langue!)
// @description:fr-CA   G√©n√©rez des r√©ponses sans fin √† partir de ChatGPT qui sait tout (dans n'importe quelle langue!)
// @description:gu      ‡™∏‡™∞‡´ç‡™µ‡™ú‡´ç‡™û‡™æ‡™®‡´Ä ChatGPT (‡™ï‡´ã‡™à‡™™‡™£ ‡™≠‡™æ‡™∑‡™æ‡™Æ‡™æ‡™Ç!) ‡™§‡™∞‡™´‡™•‡´Ä ‡™Ö‡™®‡™Ç‡™§ ‡™ú‡™µ‡™æ‡™¨‡´ã ‡™¨‡™®‡™æ‡™µ‡´ã
// @description:hi      ‡§∏‡§≠‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞ ChatGPT ‡§∏‡•á ‡§Ö‡§Ç‡§§‡§π‡•Ä‡§® ‡§â‡§§‡•ç‡§§‡§∞ ‡§â‡§§‡•ç‡§™‡§®‡•ç‡§® ‡§ï‡§∞‡•á‡§Ç (‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§≠‡§æ‡§∑‡§æ ‡§Æ‡•á‡§Ç!)
// @description:hu      Gener√°ljon v√©gtelen v√°laszokat a mindent tud√≥ ChatGPT seg√≠ts√©g√©vel (b√°rmilyen nyelven!)
// @description:in      Hasilkan jawaban tanpa akhir dari ChatGPT yang serba tahu (dalam bahasa apa pun!)
// @description:it      Genera risposte infinite da ChatGPT onnisciente (in qualsiasi lingua!)
// @description:iw      ◊î◊§◊ß ◊™◊©◊ï◊ë◊ï◊™ ◊ê◊ô◊†◊°◊ï◊§◊ô◊ï◊™ ◊û-ChatGPT ◊î◊ô◊ï◊ì◊¢ ◊î◊õ◊ú (◊ë◊õ◊ú ◊©◊§◊î!)
// @description:ja      „Åô„Åπ„Å¶„ÇíÁü•„Å£„Å¶„ÅÑ„Çã ChatGPT „Åã„ÇâÁÑ°Èôê„ÅÆÂõûÁ≠î„ÇíÁîüÊàê„Åó„Åæ„Åô (‰ªªÊÑè„ÅÆË®ÄË™û„Åß!)
// @description:ka      ·É®·Éî·É•·Éõ·Éî·Éú·Éò·Éó ·Éí·Éê·É£·Éó·Éê·Éï·Éî·Éë·Éî·Éö·Éò ·Éû·Éê·É°·É£·ÉÆ·Éî·Éë·Éò ·Éß·Éù·Éï·Éö·Éò·É°·Éõ·Éù·Éõ·É™·Éï·Éî·Éö·Éò ChatGPT-·Éì·Éê·Éú (·Éú·Éî·Éë·Éò·É°·Éõ·Éò·Éî·É† ·Éî·Éú·Éê·Éñ·Éî!)
// @description:kn      „Åô„Åπ„Å¶„ÇíÁü•„Å£„Å¶„ÅÑ„Çã ChatGPT „Åã„ÇâÁÑ°Èôê„ÅÆÂõûÁ≠î„ÇíÁîüÊàê„Åó„Åæ„Åô (‰ªªÊÑè„ÅÆË®ÄË™û„Åß!)
// @description:ko      Î™®Îì† Í≤ÉÏùÑ ÏïÑÎäî ChatGPTÏóêÏÑú ÎÅùÏóÜÎäî ÎãµÎ≥Ä ÏÉùÏÑ±(Î™®Îì† Ïñ∏Ïñ¥Î°ú!)
// @description:ku      Bersiv√™n b√™daw√Æ ji ChatGPT-a-zana (bi her ziman√Æ!)
// @description:ml      ‡¥é‡¥≤‡µç‡¥≤‡¥æ‡¥Ç ‡¥Ö‡¥±‡¥ø‡¥Ø‡µÅ‡¥®‡µç‡¥® ChatGPT-‡µΩ ‡¥®‡¥ø‡¥®‡µç‡¥®‡µç ‡¥Ö‡¥®‡¥®‡µç‡¥§‡¥Æ‡¥æ‡¥Ø ‡¥â‡¥§‡µç‡¥§‡¥∞‡¥ô‡µç‡¥ô‡µæ ‡¥∏‡µÉ‡¥∑‡µç‡¥ü‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï (‡¥è‡¥§‡µç ‡¥≠‡¥æ‡¥∑‡¥Ø‡¥ø‡¥≤‡µÅ‡¥Ç!)
// @description:mr      ‡§∏‡§∞‡•ç‡§µ‡§ú‡•ç‡§û‡§æ‡§§ ChatGPT (‡§ï‡•ã‡§£‡§§‡•ç‡§Ø‡§æ‡§π‡•Ä ‡§≠‡§æ‡§∑‡•á‡§§!) ‡§ï‡§°‡•Ç‡§® ‡§Ö‡§Ç‡§§‡§π‡•Ä‡§® ‡§â‡§§‡•ç‡§§‡§∞‡•á ‡§µ‡•ç‡§Ø‡•Å‡§§‡•ç‡§™‡§®‡•ç‡§® ‡§ï‡§∞‡§æ.
// @description:ms      Hasilkan jawapan yang tidak berkesudahan daripada ChatGPT yang serba tahu (dalam mana-mana bahasa!)
// @description:my      ·Ä°·Ä¨·Ä∏·Äú·ÄØ·Ä∂·Ä∏·Äû·Ä≠·Äû·Ä±·Ä¨ ChatGPT (·Äô·Ää·Ä∫·Äû·Ää·Ä∑·Ä∫·Äò·Ä¨·Äû·Ä¨·ÄÖ·ÄÄ·Ä¨·Ä∏·Äñ·Äº·ÄÑ·Ä∑·Ä∫·Äô·ÄÜ·Ä≠·ÄØ) ·Äô·Äæ ·Ä°·ÄÜ·ÄØ·Ä∂·Ä∏·Äô·Ä≤·Ä∑·Ä°·Äñ·Äº·Ä±·Äô·Äª·Ä¨·Ä∏·ÄÄ·Ä≠·ÄØ ·Äñ·Äî·Ä∫·Äê·ÄÆ·Ä∏·Äï·Ä´·Åã
// @description:nl      Genereer eindeloze antwoorden van alwetende ChatGPT (in elke taal!)
// @description:no      Generer endel√∏se svar fra allvitende ChatGPT (p√• hvilket som helst spr√•k!)
// @description:or      ‡¨∏‡¨Æ‡¨∏‡≠ç‡¨§ ‡¨ú‡¨æ‡¨£‡¨ø‡¨¨‡¨æ ChatGPT ‡¨∞‡≠Å ‡¨Ö‡¨∏‡≠Ä‡¨Æ ‡¨â‡¨§‡≠ç‡¨§‡¨∞ ‡¨∏‡≠É‡¨∑‡≠ç‡¨ü‡¨ø ‡¨ï‡¨∞‡¨®‡≠ç‡¨§‡≠Å (‡¨Ø‡≠á‡¨ï language ‡¨£‡¨∏‡¨ø ‡¨≠‡¨æ‡¨∑‡¨æ‡¨∞‡≠á!)
// @description:pa      ‡®∏‡®≠-‡®ú‡®æ‡®£‡®® ‡®µ‡®æ‡®≤‡©á ‡®ö‡©à‡®ü‡®ú‡©Ä‡®™‡©Ä‡®ü‡©Ä (‡®ï‡®ø‡®∏‡©á ‡®µ‡©Ä ‡®≠‡®æ‡®∏‡®º‡®æ ‡®µ‡®ø‡©±‡®ö!) ‡®§‡©ã‡®Ç ‡®¨‡©á‡®Ö‡©∞‡®§ ‡®ú‡®µ‡®æ‡®¨ ‡®§‡®ø‡®Ü‡®∞ ‡®ï‡®∞‡©ã
// @description:pl      Generuj nieko≈ÑczƒÖce siƒô odpowiedzi z wszechwiedzƒÖcego ChatGPT (w dowolnym jƒôzyku!)
// @description:pt      Gere respostas infinitas do onisciente ChatGPT (em qualquer idioma!)
// @description:pt-BR   Gere respostas infinitas do onisciente ChatGPT (em qualquer idioma!)
// @description:ro      Genera»õi rƒÉspunsuri nesf√¢r»ôite de la atot»ôtiutorul ChatGPT (√Æn orice limbƒÉ!)
// @description:ru      –°–æ–∑–¥–∞–≤–∞–π—Ç–µ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –æ—Ç –≤—Å–µ–∑–Ω–∞—é—â–µ–≥–æ ChatGPT (–Ω–∞ –ª—é–±–æ–º —è–∑—ã–∫–µ!)
// @description:sk      Generujte nekoneƒçn√© odpovede od v≈°evediaceho ChatGPT (v akomkoƒævek jazyku!)
// @description:sr      –ì–µ–Ω–µ—Ä–∏—à–∏—Ç–µ –±–µ—Å–∫—Ä–∞—ò–Ω–µ –æ–¥–≥–æ–≤–æ—Ä–µ –æ–¥ —Å–≤–µ–∑–Ω–∞—ò—É—õ–µ–≥ –¶—Ö–∞—Ç–ì–ü–¢-–∞ (–Ω–∞ –±–∏–ª–æ –∫–æ–º —ò–µ–∑–∏–∫—É!)
// @description:sv      Generera o√§ndliga svar fr√•n allvetande ChatGPT (p√• vilket spr√•k som helst!)
// @description:ta      ‡ÆÖ‡Æ©‡Øà‡Æ§‡Øç‡Æ§‡Øà‡ÆØ‡ØÅ‡ÆÆ‡Øç ‡ÆÖ‡Æ±‡Æø‡Æ®‡Øç‡Æ§ ChatGPT ‡Æá‡Æ≤‡Æø‡Æ∞‡ØÅ‡Æ®‡Øç‡Æ§‡ØÅ ‡ÆÆ‡ØÅ‡Æü‡Æø‡Æµ‡Æ±‡Øç‡Æ± ‡Æ™‡Æ§‡Æø‡Æ≤‡Øç‡Æï‡Æ≥‡Øà ‡Æâ‡Æ∞‡ØÅ‡Æµ‡Ææ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç (‡Æé‡Æ®‡Øç‡Æ§ ‡ÆÆ‡Øä‡Æ¥‡Æø‡ÆØ‡Æø‡Æ≤‡ØÅ‡ÆÆ‡Øç!)
// @description:th      ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏à‡∏ö‡∏à‡∏≤‡∏Å ChatGPT ‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏ö‡∏£‡∏π‡πâ (‡πÉ‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÉ‡∏î‡∏Å‡πá‡πÑ‡∏î‡πâ!)
// @description:tr      Her ≈üeyi bilen ChatGPT'den sonsuz cevaplar olu≈üturun (herhangi bir dilde!)
// @description:uk      –ì–µ–Ω–µ—Ä—É–π—Ç–µ –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –≤—ñ–¥ –≤—Å–µ–∑–Ω–∞—é—á–æ–≥–æ ChatGPT (–±—É–¥—å-—è–∫–æ—é –º–æ–≤–æ—é!)
// @description:ur      ÿ™ŸÖÿßŸÖ ÿ¨ÿßŸÜŸÜ€í ŸàÿßŸÑ€í ChatGPT ÿ≥€í ŸÑÿßŸÖÿ™ŸÜÿß€Å€å ÿ¨Ÿàÿßÿ®ÿßÿ™ ÿ™€åÿßÿ± ⁄©ÿ±€å⁄∫ (⁄©ÿ≥€å ÿ®⁄æ€å ÿ≤ÿ®ÿßŸÜ ŸÖ€å⁄∫!)
// @description:vi      T·∫°o v√¥ s·ªë c√¢u tr·∫£ l·ªùi t·ª´ ChatGPT to√†n nƒÉng (b·∫±ng b·∫•t k·ª≥ ng√¥n ng·ªØ n√†o!)
// @description:zh-CN   ‰ªéÊó†ÊâÄ‰∏çÁü•ÁöÑ ChatGPT ÁîüÊàêÊó†Á©∑Êó†Â∞ΩÁöÑÁ≠îÊ°à (Áî®‰ªª‰ΩïËØ≠Ë®Ä!)
// @description:zh-HK   ÂæûÁÑ°ÊâÄ‰∏çÁü•ÁöÑ ChatGPT ÁîüÊàêÁÑ°Á™ÆÁÑ°Áõ°ÁöÑÁ≠îÊ°à (Áî®‰ªª‰ΩïË™ûË®Ä!)
// @description:zh-SG   ‰ªéÊó†ÊâÄ‰∏çÁü•ÁöÑ ChatGPT ÁîüÊàêÊó†Á©∑Êó†Â∞ΩÁöÑÁ≠îÊ°à (Áî®‰ªª‰ΩïËØ≠Ë®Ä!)
// @description:zh-TW   ÂæûÁÑ°ÊâÄ‰∏çÁü•ÁöÑ ChatGPT ÁîüÊàêÁÑ°Á™ÆÁÑ°Áõ°ÁöÑÁ≠îÊ°à (Áî®‰ªª‰ΩïË™ûË®Ä!)
// @author              Adam Lui
// @namespace           https://github.com/adamlui
// @license             MIT
// @match               https://chat.openai.com/*
// @icon                https://raw.githubusercontent.com/adamlui/userscripts/master/chatgpt/media/icons/openai-favicon48.png
// @icon64              https://raw.githubusercontent.com/adamlui/userscripts/master/chatgpt/media/icons/openai-favicon64.png
// @compatible          chrome
// @compatible          firefox
// @compatible          edge
// @compatible          opera
// @compatible          brave
// @compatible          vivaldi
// @compatible          waterfox
// @compatible          librewolf
// @compatible          ghost
// @compatible          qq
// @require             https://cdn.jsdelivr.net/gh/chatgptjs/chatgpt.js@51dc48d5bff8e5539e8cee273032360d0691c6a6/dist/chatgpt-1.6.5.min.js
// @connect             raw.githubusercontent.com
// @grant               GM_setValue
// @grant               GM_getValue
// @grant               GM_registerMenuCommand
// @grant               GM_unregisterMenuCommand
// @grant               GM.xmlHttpRequest
// @noframes
// @updateURL           https://greasyfork.org/scripts/465051/code/chatgpt-infinity.meta.js
// @downloadURL         https://greasyfork.org/scripts/465051/code/chatgpt-infinity.user.js
// @homepageURL         https://chatgptevo.com/infinity
// @supportURL          https://chatgptevo.com/infinity/support
// ==/UserScript==

// NOTE: This script relies on the powerful chatgpt.js library @ https://chatgpt.js.org (c) 2023 Adam Lui, chatgpt.js & contributors under the MIT license.

(async () => {

    // Initialize settings
    var configKeyPrefix = 'chatGPTinf_'
    var config = { userLanguage: navigator.languages[0] || navigator.language || '', infinityMode: false }
    loadSetting('toggleHidden', 'autoScrollDisabled', 'replyLanguage', 'replyInterval')
    if (!config.replyLanguage) saveSetting('replyLanguage', navigator.languages[0] || navigator.language || '') // init reply language
    if (!config.replyInterval) saveSetting('replyInterval', 7) // init refresh interval to 7 secs if unset

    // Define messages
    var msgsLoaded = new Promise(resolve => {
        var msgHostDir = 'https://raw.githubusercontent.com/adamlui/chatgpt-infinity/main/greasemonkey/_locales/'
        var msgLocaleDir = ( config.userLanguage ? config.userLanguage.replace('-', '_') : 'en' ) + '/'
        var msgHref = msgHostDir + msgLocaleDir + 'messages.json' // build src link
        var msgXHRtries = 0
        GM.xmlHttpRequest({ method: 'GET', url: msgHref, onload: onLoad })
        function onLoad(response) {
            try { // to return localized messages.json
                var messages = JSON.parse(response.responseText)
                var cleanerMsgs = new Proxy(messages, { // remove need to ref nested keys
                    get(target, prop) {
                        if (typeof target[prop] === 'object' && target[prop] !== null && 'message' in target[prop]) {
                            return target[prop].message
                }}}) ; resolve(cleanerMsgs)
            } catch (error) { // if 404
                msgXHRtries++ ; if (msgXHRtries == 3) return // try up to 3X (original/region-stripped/EN) only
                msgHref = config.userLanguage.includes('-') && msgXHRtries == 1 ? // if regional lang on 1st try...
                    msgHref.replace(/(.*)_.*(\/.*)/, '$1$2') // ...strip region before retrying
                        : ( msgHostDir + 'en/messages.json' ) // else use default English messages
                GM.xmlHttpRequest({ method: 'GET', url: msgHref, onload: onLoad })
            }
        }
    }) ; var messages = await msgsLoaded

    // Init/register menu
    var menuIDs = [], stateSymbol = ['‚úîÔ∏è', '‚ùå'], stateWord = ['ON', 'OFF'] // initialize menu vars
    registerMenu() // create browser toolbar menu

    await chatgpt.isLoaded()

    // Stylize toggle switch
    var switchStyle = document.createElement('style')
    switchStyle.innerHTML = `/* Stylize switch */
        .switch { position:absolute ; left:208px ; width:34px ; height:18px }
        .switch input { opacity:0 ; width:0 ; height:0 } /* hide checkbox */
        .slider { position:absolute ; cursor:pointer ; top:0 ; left:0 ; right:0 ; bottom:0 ; background-color:#ccc ; -webkit-transition:.4s ; transition:.4s ; border-radius:28px }
        .slider:before { position:absolute ; content:"" ; height:14px ; width:14px ; left:3px; bottom:2px ; background-color:white ; -webkit-transition:.4s ; transition:.4s ; border-radius:28px }

        /* Position/color ON-state */
        input:checked { position:absolute ; right:3px }
        input:checked + .slider { background-color:#42B4BF }
        input:checked + .slider:before {
            -webkit-transform: translateX(14px) translateY(1px) ;
            -ms-transform: translateX(14px) translateY(1px) ;
            transform: translateX(14px) }`

    document.head.appendChild(switchStyle)

    // Create toggle label, add listener/classes/HTML
    var toggleLabel = document.createElement('div') // create label div
    toggleLabel.addEventListener('click', function() {
        var toggleInput = document.querySelector('#infinityToggle')
        toggleInput.click() ; infinityMode.toggle()
    })
    for (var link of document.querySelectorAll('a')) { // inspect sidebar links for classes
        if (link.innerHTML.includes('New chat')) { // focus on 'New chat'
            toggleLabel.setAttribute('class', link.classList) // borrow its classes
            break // stop looping since class assignment is done
        }
    } updateToggleHTML()

    // Insert full toggle on page load + during navigation // Âú®ÂØºËà™ÊúüÈó¥ÊèíÂÖ•È°µÈù¢Âä†ËΩΩ + ÁöÑÂÆåÊï¥ÂàáÊç¢
    insertToggle()
    var navObserver = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            if (mutation.type === 'childList' && mutation.addedNodes.length) {
                insertToggle()
    }})})
    navObserver.observe(document.documentElement, { childList: true, subtree: true })

    // Define SCRIPT functions

    function registerMenu() {
        menuIDs = [] // empty to store newly registered cmds for removal while preserving order
        var stateSeparator = getUserscriptManager() === 'Tampermonkey' ? ' ‚Äî ' : ': '

        // Add command to toggle Infinity Mode
        var imLabel = stateSymbol[+!config.infinityMode] + ' ' + messages.menuLabel_infinityMode + ' ‚àû '
            + stateSeparator + stateWord[+!config.infinityMode]
        menuIDs.push(GM_registerMenuCommand(imLabel, function() {
            document.querySelector('#infinityToggle').click()
        }))

        // Add command to toggle visibility of toggle
        var tvLabel = stateSymbol[+config.toggleHidden] + ' ' + messages.menuLabel_toggleVis
            + stateSeparator + stateWord[+config.toggleHidden]
        menuIDs.push(GM_registerMenuCommand(tvLabel, function() {
            saveSetting('toggleHidden', !config.toggleHidden)
            toggleLabel.style.display = config.toggleHidden ? 'none' : 'flex' // toggle visibility
            if (!config.notifHidden) {
                chatgpt.notify('‚àû ' + messages.menuLabel_toggleVis + ': '+ stateWord[+config.toggleHidden],
                    '', '', chatgpt.isDarkMode() ? '' : 'shadow')
            } for (var id of menuIDs) GM_unregisterMenuCommand(id) ; registerMenu() // refresh menu
        }))

        // Add command to toggle auto-scroll
        var asLabel = stateSymbol[+config.autoScrollDisabled] + ' ' + messages.menuLabel_autoScroll
            + stateSeparator + stateWord[+config.autoScrollDisabled]
        menuIDs.push(GM_registerMenuCommand(asLabel, function() {
            saveSetting('autoScrollDisabled', !config.autoScrollDisabled)
            if (!config.notifHidden) {
                chatgpt.notify('‚àû ' + messages.menuLabel_autoScroll + ': '+ stateWord[+config.autoScrollDisabled],
                    '', '', chatgpt.isDarkMode() ? '' : 'shadow')
            } for (var id of menuIDs) GM_unregisterMenuCommand(id) ; registerMenu() // refresh menu
        }))

        // Add command to set language
        var rlLabel = 'üåê ' + messages.menuLabel_replyLang + stateSeparator
                    + ( config.replyLanguage ? config.replyLanguage : 'English' )
        menuIDs.push(GM_registerMenuCommand(rlLabel, async function() {
            while (true) {
                var replyLanguage = prompt(`${ messages.prompt_updateReplyLang }:`, config.replyLanguage)
                if (replyLanguage === null) break // user cancelled so do nothing
                else if (!/\d/.test(replyLanguage)) {
                    saveSetting('replyLanguage', replyLanguage)
                    alert(`${ messages.alert_willReplyIn } ${ replyLanguage ? replyLanguage : messages.alerts.yourSysLang }.`)
                    if (config.infinityMode) { // restart session using new reply language
                        chatgpt.stop() ; infinityMode.deactivate() ; infinityMode.toggle() }
                    for (var id of menuIDs) GM_unregisterMenuCommand(id) ; registerMenu() // refresh menu
                    break
        }}}))

        // Add command to change reply interval
        var riLabel = '‚åö ' + messages.menuLabel_replyInt + stateSeparator + config.replyInterval + 's'
        menuIDs.push(GM_registerMenuCommand(riLabel, async function() {
            while (true) {
                var replyInterval = prompt(`${ messages.prompt_updateReplyInt }:`, config.replyInterval)
                if (replyInterval === null) break // user cancelled so do nothing
                else if (!isNaN(parseInt(replyInterval)) && parseInt(replyInterval) > 4) { // valid int set
                    saveSetting('replyInterval', parseInt(replyInterval))
                    alert(`${ messages.alert_willReplyEvery } ${ replyInterval } ${ messages.unit_seconds }.`)
                    if (config.infinityMode) { // reset reply interval w/o ending session
                        clearTimeout(infinityMode.isActive) ; await chatgpt.isIdle()
                        if (config.infinityMode && !infinityMode.isActive) { // double-check in case de-activated before scheduled
                            infinityMode.isActive = setTimeout(infinityMode.continue, parseInt(config.replyInterval) * 1000)
                    }}
                    for (var id of menuIDs) GM_unregisterMenuCommand(id) ; registerMenu() // refresh menu
                    break
        }}}))
    }

    function getUserscriptManager() { try { return GM_info.scriptHandler } catch(error) { return 'other' }}

    function loadSetting() {
        var keys = [].slice.call(arguments)
        keys.forEach(function(key) {
            config[key] = GM_getValue(configKeyPrefix + key, false)
    })}

    function saveSetting(key, value) {
        GM_setValue(configKeyPrefix + key, value) // save to browser
        config[key] = value // and memory
    }

    // Define TOGGLE functions

    function insertToggle() {
        var firstMenu = document.querySelector('nav')
        if (!firstMenu.contains(toggleLabel)) { // check if label exists first // Ê£ÄÊü•Ê†áÁ≠æÊòØÂê¶È¶ñÂÖàÂ≠òÂú®
            firstMenu.insertBefore(toggleLabel, firstMenu.childNodes[0]) // insert before 'New chat'// Âú®"Êñ∞ËÅäÂ§©"‰πãÂâçÊèíÂÖ•
    }}

    function updateToggleHTML() {
        toggleLabel.innerHTML = `
            <img width="18px" src="https://raw.githubusercontent.com/adamlui/chatgpt-infinity/main/media/images/icons/infinity-icon/icon64.png">
            ${ messages.menuLabel_infinityMode } ${config.infinityMode ? messages.state_enabled : messages.state_disabled }
            <label class="switch" ><input id="infinityToggle" type="checkbox"
                ${ config.infinityMode ? 'checked="true"' : '' } >
                <span class="slider"></span></label>`
        toggleLabel.style.display = config.toggleHidden ? 'none' : 'flex'
    }

    var infinityMode = {

        activate: async function() {
            if (!config.notifHidden) {
                chatgpt.notify('‚àû ' + messages.menuLabel_infinityMode + ': ON', '', '', chatgpt.isDarkMode() ? '' : 'shadow')
            }
            document.querySelector('nav > a').click()
            setTimeout(function() {
                chatgpt.send('generate a single random q&a' + ( config.replyLanguage ? ( ' in ' + config.replyLanguage ) : ''  )
                                                            + '. don\'t type anything else') }, 500)
            infinityMode.sent = true ; await chatgpt.isIdle()
            if (config.infinityMode && !infinityMode.isActive) { // double-check in case de-activated before scheduled
                infinityMode.isActive = setTimeout(infinityMode.continue, parseInt(config.replyInterval) * 1000)
            }
        },

        continue: async function() {
            chatgpt.send('do it again')
            if (!config.autoScrollDisabled) try { chatgpt.scrollToBottom() } catch(error) {}
            await chatgpt.isIdle() // before starting delay till next iteration
            if (infinityMode.isActive) infinityMode.isActive = setTimeout(infinityMode.continue, parseInt(config.replyInterval) * 1000)
        },

        deactivate: function() {
            clearTimeout(infinityMode.isActive) ; infinityMode.isActive = null, infinityMode.sent = null
            if (!config.notifHidden) {
                chatgpt.notify('‚àû ' + messages.menuLabel_infinityMode + ': OFF', '', '', chatgpt.isDarkMode() ? '' : 'shadow')
            }
        },

        toggle: async function() {
            var toggleInput = document.querySelector('#infinityToggle')
            setTimeout(updateToggleHTML, 200) // sync label change w/ switch movement
            config.infinityMode = toggleInput.checked
            for (var i = 0 ; i < menuIDs.length ; i++) GM_unregisterMenuCommand(menuIDs[i]) ; registerMenu() // refresh menu
            chatgpt.stop()
            if (config.infinityMode && !infinityMode.sent) infinityMode.activate()
            else if (!config.infinityMode && infinityMode.sent) infinityMode.deactivate()
        }
    }

})()
